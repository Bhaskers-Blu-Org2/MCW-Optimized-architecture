<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>MCW: Optimized Architecture – includes</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://opsgilitylabs.blob.core.windows.net/lablayout/labstyles.css"></link>
</head>
<body>
<h1 id="optimized-architecture">Optimized architecture</h1>
<h2 id="march-2018-hands-on-lab-unguided">March 2018 Hands-on lab unguided</h2>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#solution-architecture">Solution architecture</a></li>
<li><a href="#before-the-hands-on-lab">Before the hands-on lab</a>
<ul>
<li><a href="#task-1-create-a-virtual-machine-for-your-lab-environment">Task 1: Create a virtual machine for your lab environment</a></li>
<li><a href="#task-2-disable-ie-enhanced-security">Task 2: Disable IE Enhanced Security</a></li>
<li><a href="#task-3-download-the-sample-app-files">Task 3: Download the Sample App Files</a></li>
<li><a href="#task-4-deploy-sample-app-and-existing-environment">Task 4: Deploy Sample App and “Existing” Environment</a></li>
</ul></li>
<li><a href="#exercise-1-determine-appropriate-app-service-tiers-and-estimate-cost-savings">Exercise 1: Determine Appropriate App Service Tiers and Estimate Cost Savings</a>
<ul>
<li><a href="#help-references">Help references</a></li>
<li><a href="#scenario">Scenario</a></li>
<li><a href="#task-1-calculate-estimated-hosting-cost-of-existing-solution">Task 1: Calculate Estimated Hosting Cost of Existing Solution</a></li>
<li><a href="#task-2-calculate-estimated-hosting-cost-of-vms-with-reserved-instances">Task 2: Calculate Estimated Hosting Cost of VMs with Reserved Instances</a></li>
<li><a href="#task-3-estimate-necessary-app-service-tiers">Task 3: Estimate Necessary App Service Tiers</a></li>
<li><a href="#task-4-calculate-estimated-hosting-cost-of-azure-app-service">Task 4: Calculate Estimated Hosting Cost of Azure App Service</a></li>
<li><a href="#task-5-calculate-estimated-cost-savings">Task 5: Calculate Estimated Cost Savings</a></li>
</ul></li>
<li><a href="#exercise-2-integrate-traffic-manager">Exercise 2: Integrate Traffic Manager</a>
<ul>
<li><a href="#help-references-1">Help references</a></li>
<li><a href="#task-1-create-traffic-manager">Task 1: Create Traffic Manager</a></li>
<li><a href="#task-2-point-traffic-manager-to-external-internet-load-balancer">Task 2: Point Traffic Manager to External / Internet Load Balancer</a></li>
</ul></li>
<li><a href="#exercise-3-setup-api-tier-in-azure-app-service">Exercise 3: Setup API Tier in Azure App Service</a>
<ul>
<li><a href="#task-1-create-app-service-for-web-api-tier">Task 1: Create App Service for Web API Tier</a></li>
<li><a href="#task-2-setup-app-settings">Task 2: Setup App Settings</a></li>
<li><a href="#task-3-deploy-api-to-app-service">Task 3: Deploy API to App Service</a></li>
</ul></li>
<li><a href="#exercise-4-migrate-web-app-tier-to-app-service">Exercise 4: Migrate Web App Tier to App Service</a>
<ul>
<li><a href="#task-1-create-app-service-for-web-app-tier">Task 1: Create App Service for Web App Tier</a></li>
<li><a href="#task-2-setup-app-settings-1">Task 2: Setup App Settings</a></li>
<li><a href="#task-3-deploy-app-to-web-app">Task 3: Deploy App to Web App</a></li>
<li><a href="#task-4-add-web-app-to-traffic-manager">Task 4: Add Web App to Traffic Manager</a></li>
<li><a href="#task-5-take-down-web-app-and-api-vms">Task 5: Take down Web App and API VMs</a></li>
</ul></li>
<li><a href="#exercise-5-migrate-background-tier-to-app-service">Exercise 5: Migrate Background Tier to App Service</a>
<ul>
<li><a href="#task-1-create-app-service-for-background-tier">Task 1: Create App Service for Background Tier</a></li>
<li><a href="#task-2-setup-app-settings-2">Task 2: Setup App Settings</a></li>
<li><a href="#task-3-deploy-app-to-app-service">Task 3: Deploy App to App Service</a></li>
<li><a href="#task-4-take-down-background-tier-vm">Task 4: Take down Background Tier VM</a></li>
</ul></li>
<li><a href="#exercise-6-setup-sql-database-geo-replication">Exercise 6: Setup SQL Database Geo-Replication</a>
<ul>
<li><a href="#task-1-setup-sql-database-geo-replication">Task 1: Setup SQL Database Geo-Replication</a></li>
</ul></li>
<li><a href="#exercise-7-take-down-old-architecture-resources">Exercise 7: Take down old architecture / resources</a>
<ul>
<li><a href="#task-1-remove-old-vm-based-tiers">Task 1: Remove old VM-based tiers</a></li>
</ul></li>
<li><a href="#exercise-8-setup-european-web-app-tier-instance">Exercise 8: Setup European Web App Tier Instance</a>
<ul>
<li><a href="#task-1-create-european-app-service">Task 1: Create European App Service</a></li>
<li><a href="#task-2-set-app-settings">Task 2: Set App Settings</a></li>
<li><a href="#task-3-deploy-web-app-to-european-region">Task 3: Deploy Web App to European Region</a></li>
<li><a href="#task-4-add-european-region-to-traffic-manager">Task 4: Add European Region to Traffic Manager</a></li>
</ul></li>
<li><a href="#after-the-hands-on-lab">After the hands-on lab</a>
<ul>
<li><a href="#task-1-delete-resources">Task 1: Delete Resources</a></li>
</ul></li>
</ul>
<h2 id="optimized-architecture-hands-on-lab-unguided">Optimized Architecture hands-on lab unguided</h2>
<h2 id="abstract-and-learning-objectives">Abstract and learning objectives</h2>
<p>In this workshop, students will learn how to optimize a lift and shift style IaaS architecture in Azure to improve cost savings. Students will also compare IaaS and PaaS hosting options to save cost even further using Azure App Service. Additionally, students will learn to improve resiliency and high availability through multi-region deployment.</p>
<p>Attendees will learn how to:</p>
<ul>
<li><p>Optimize Azure IaaS for cost savings</p></li>
<li><p>Migrate an Azure IaaS optimized</p></li>
<li><p>Compare cost between Azure IaaS versus Azure PaaS</p></li>
<li><p>Setup SQL Database geo-replication</p></li>
<li><p>Configure multi-region deployment</p></li>
</ul>
<h2 id="overview">Overview</h2>
<p>The Optimized Architecture hands-on lab (HOL) is a hands-on exercise that will challenge you to calculate Azure spending optimizations by comparing IaaS and PaaS services using a supplied sample application (a 3-tier application written in C# and ASP.NET MVC) that is based on Microsoft Azure IaaS services such as Virtual Machines, Virtual Network, Load Balancers, Storage and SQL Database. In addition to calculating estimated Azure cost of the existing architecture, you will need to calculate the estimated cost of hosting the sample application using Azure PaaS services. The scenario will include migrating the full sample application to be hosted on Azure PaaS services such as Azure App Service Web Apps, Web Jobs, and Traffic Manager as well as implementing a secondary hosting region for the Web App tier and database replication.</p>
<p>The HOL can be implemented on your own, but it is highly recommended to pair up with other members at the HOL to model a real-world experience much closer and to allow each member to share their expertise for the overall solutions.</p>
<h2 id="requirements">Requirements</h2>
<ol type="1">
<li><p>Microsoft Azure subscription</p></li>
<li><p>Local machine or a virtual machine configured with Visual Studio 2017 Community Edition or better</p></li>
</ol>
<h2 id="solution-architecture">Solution architecture</h2>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image2.png" title="Solution architecture" alt="Using Traffic Manager" /><figcaption>Using Traffic Manager</figcaption>
</figure>
<h2 id="before-the-hands-on-lab">Before the hands-on lab</h2>
<p>Duration: 20 minutes</p>
<p>In this exercise, you will set up an environment to use for the rest of the exercises.</p>
<h4 id="task-1-create-a-virtual-machine-for-your-lab-environment">Task 1: Create a virtual machine for your lab environment</h4>
<ol type="1">
<li><p>Launch a browser using incognito or in-private mode, and navigate to <a href="https://portal.azure.com" class="uri">https://portal.azure.com</a>. Once prompted, login with your Microsoft Azure credentials. If prompted, choose whether your account is an organization account or just a Microsoft Account.</p></li>
<li><p>Click on <strong>+ Create Resource</strong>, and in the search box, type in Visual Studio Community 2017 on Windows Server 2016 (x64), and press enter. Click the Visual Studio Community 2017 image running on Windows Server 2016 and with the latest update.</p></li>
<li><p>In the returned search results, click the image name.</p>
<blockquote>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image3.png" title="Everything blade" alt="In the Everything blade, Visual Studio Community 2017 is typed in the Search field. Under Name, Visual Studio Community on Windows Server 2016 is circled." /><figcaption>In the Everything blade, Visual Studio Community 2017 is typed in the Search field. Under Name, Visual Studio Community on Windows Server 2016 is circled.</figcaption>
</figure>
</blockquote></li>
<li><p>In the Marketplace solution blade, click <strong>Create</strong>.</p></li>
<li><p>Set the following configuration on the Basics tab, and click <strong>OK</strong>.</p>
<ul>
<li><p>Name: <strong>LABVM</strong></p></li>
<li><p>VM disk type: <strong>SSD</strong></p></li>
<li><p>User name: <strong>demouser</strong></p></li>
<li><p>Password: <strong>demo@pass123</strong></p></li>
<li><p>Subscription: <strong>If you have multiple subscriptions choose the subscription to execute your labs in.</strong></p></li>
<li><p>Resource Group: <strong>OPSLABRG</strong></p></li>
<li><p>Location: <strong>Choose the closest Azure region to you.</strong></p></li>
</ul></li>
<li><p>Choose the <strong>DS1_V2 Standard</strong> instance size on the Size blade.</p></li>
<li><p>Accept the remaining default values on the Settings blade, and click <strong>OK</strong>. On the Summary page, click <strong>OK</strong>. The deployment should begin provisioning. It may take more than 10 minutes for the virtual machine to complete provisioning.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image4.png" title="Deploying Visual Studio Community 2017 icon" alt="Screenshot of the Deploying Visual Studio Community 2017 icon." /><figcaption>Screenshot of the Deploying Visual Studio Community 2017 icon.</figcaption>
</figure></li>
</ol>
<h4 id="task-2-disable-ie-enhanced-security">Task 2: Disable IE Enhanced Security</h4>
<blockquote>
<p>Note: Sometimes this image has IE ESC disabled. Sometimes it does not.</p>
</blockquote>
<ol type="1">
<li><p>On the new VM, you just created click the <strong>Server Manager</strong> icon.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image5.png" title="Server Manager icon" alt="Screenshot of the Server Manager icon." /><figcaption>Screenshot of the Server Manager icon.</figcaption>
</figure></li>
<li><p>Click <strong>Local Server</strong>.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image6.png" title="Server Manager icon drop-down menu" alt="Local Server is selected from the Server Manager icon drop-down menu." /><figcaption>Local Server is selected from the Server Manager icon drop-down menu.</figcaption>
</figure></li>
<li><p>On the right side of the pane, click <strong>On</strong> by IE Enhanced Security Configuration.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image7.png" title="IE Enhanced Security Configuration" alt="IE Enhanced Security Configuration is set to On." /><figcaption>IE Enhanced Security Configuration is set to On.</figcaption>
</figure></li>
<li><p>Change to <strong>Off</strong> for Administrators and click <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image8.png" title="Internet Explorer Enhanced Security Configuration Dialog box" alt="In the Internet Explorer Enhanced Security Configuration Dialog box, Administrators is set to Off." /><figcaption>In the Internet Explorer Enhanced Security Configuration Dialog box, Administrators is set to Off.</figcaption>
</figure></li>
</ol>
<h4 id="task-3-download-the-sample-app-files">Task 3: Download the Sample App Files</h4>
<ol type="1">
<li><p>Create a new folder on your C: drive named <strong>HOL</strong>.</p></li>
<li><p>Download the sample application and ARM template (optimized-architecture-student.zip) from here: <a href="https://cloudworkshop.blob.core.windows.net/optimized-architecture/OptimizedArchitecture-StudentFiles-6-2017.zip" class="uri">https://cloudworkshop.blob.core.windows.net/optimized-architecture/OptimizedArchitecture-StudentFiles-6-2017.zip</a>.</p></li>
<li><p>Right click on the downloaded .zip file and click <strong>Properties</strong>. On the properties pane check <strong>Unblock</strong> to ensure the files are marked safe.</p></li>
<li><p>Extract the zip file contents to the <strong>HOL</strong> folder.</p></li>
<li><p>From the <strong>ARMTemplate</strong> folder under <strong>HOL</strong>, open the Visual Studio Solution file: <strong>Contoso.Financial.ARMTemplate.sln</strong>.</p></li>
</ol>
<h4 id="task-4-deploy-sample-app-and-existing-environment">Task 4: Deploy Sample App and “Existing” Environment</h4>
<ol type="1">
<li><p>From the <em>C:\HOL\ARMTemplate</em> folder, open the Visual Studio Solution: <strong>Contoso.Financial.ARMTemplate.sln</strong></p></li>
<li><p>In the <strong>Solution Explorer</strong> window, right-click on the <strong>Contoso.Financial.ARMTemplate</strong> project, click <strong>Deploy</strong>, and then click <strong>New…</strong></p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image9.png" title="Solution Explorer" alt="In Solution Explorer, Contoso.Financial.ARMTemplate is selected. From its right-click menu, Deploy / New is selected." /><figcaption>In Solution Explorer, Contoso.Financial.ARMTemplate is selected. From its right-click menu, Deploy / New is selected.</figcaption>
</figure></li>
<li><p>If your Microsoft or Organization account for your Azure Subscription has not been added to Visual Studio yet, click on <strong>Add an account</strong>, then <strong>Add an account…</strong>, and follow the prompts to login.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image10.png" title="Deploy to Resource Group dialog box" alt="Add an account is selected in the Deploy to Resource Group dialog box." /><figcaption>Add an account is selected in the Deploy to Resource Group dialog box.</figcaption>
</figure></li>
<li><p>Click on the <strong>Resource group</strong> dropdown, followed by selecting <strong>&lt;Create New…&gt;.</strong></p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image11.png" title="Deploy to Resource Group dialog box" alt="In the Deploy to Resource Group dialog box, Create New is selected from the Resource group drop-down menu." /><figcaption>In the Deploy to Resource Group dialog box, Create New is selected from the Resource group drop-down menu.</figcaption>
</figure></li>
<li><p>On the <strong>Create Resource Group</strong> dialog, enter the following values:</p>
<ul>
<li><p>Resource group name: <strong>ContosoExistingRG</strong></p></li>
<li><p>Resource group location: <strong>North Central US</strong></p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image12.png" title="Create Resource Group dialog box" alt="Fields in the Create Resource Group dialog box are set to the previously defined settings." /><figcaption>Fields in the Create Resource Group dialog box are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click the <strong>Create</strong> button.</p></li>
<li><p>On the <strong>Deploy to Resource Group</strong> dialog, click the <strong>Deploy</strong> button to deploy the ARM Template to the newly created Resource Group.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image13.png" title="Deploy to Resource Group dialog box" alt="In the Deploy to Resource Group dialog box, the Deploy button is selected." /><figcaption>In the Deploy to Resource Group dialog box, the Deploy button is selected.</figcaption>
</figure></li>
<li><p>Deployment status of the ARM Template will be displayed in the <strong>Output</strong> window within Visual Studio.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image14.png" title="Visual Studio Output Window" alt="Deployment status displays in the Visual Studio Output Window." /><figcaption>Deployment status displays in the Visual Studio Output Window.</figcaption>
</figure></li>
<li><p>Once the deployment has completed successfully, the <strong>IP Address</strong> and <strong>FQDN</strong> of the External / Internet Load Balancer for the Web App tier will be displayed in the output window.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image15.png" title="Output Window" alt="The IP Address for the Esternal / Internal Load Balancer are circled in the Output Window." /><figcaption>The IP Address for the Esternal / Internal Load Balancer are circled in the Output Window.</figcaption>
</figure>
<blockquote>
The <strong>Username</strong> and <strong>Password</strong> for the VMs and SQL Database created by the ARM Template are:
<ul>
<li>Username: <strong>demouser</strong></li>
<li>Password: <strong>demo@pass123</strong></li>
</ul>
</blockquote></li>
<li><p>Open a new <strong>Web Browser</strong> window, and navigate to the Web App tier using the <strong>Internet Load Balancer IP Address</strong>.<br />
<br />
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image16.png" title="Contoso Financial Login webpage" alt="The Contoso Financial Login webpage displays." /></p></li>
<li><p>To login to the Web App Tier of the Contoso Financial sample application, simply enter <strong>any email address and password</strong>, followed by clicking on <strong>Sign in</strong>.</p></li>
<li><p>Once logged in, the sample application will display a simple <strong>Account Transaction</strong> ledger.<br />
<br />
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image17.png" title="Contoso Financial Account Overview webpage" alt="The Contoso Financial Account Overview webpage displays with Transaction details in an account transaction ledger." /></p>
<blockquote>
<p>Leaving the browser open to the Account Overview page will automatically load new transactions as they are generated by the background process, since the web page has a JavaScript timer that checks for new transactions periodically. You should follow all steps provided <em>before</em> attending the Hands-on lab</p>
</blockquote></li>
</ol>
<h2 id="exercise-1-determine-appropriate-app-service-tiers-and-estimate-cost-savings">Exercise 1: Determine Appropriate App Service Tiers and Estimate Cost Savings</h2>
<p>Contoso Financial has asked you to optimize their Azure spending by migrating their existing Azure IaaS based architecture over to Azure PaaS services. You will need to determine the appropriate hosting tiers and estimate the total cost savings on a monthly and annual basis.</p>
<h4 id="help-references">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/pricing/calculator">Azure Pricing Calculator</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machines/">Virtual Machines Pricing</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/app-service">App Service Pricing</a></p>
<h4 id="scenario">Scenario</h4>
<p>Contoso Financial recently performed a lift-and-shift to move their application into Microsoft Azure using the North Central US region. As a result, the existing architecture of the application is implemented with Virtual Machines, Load Balancers, Availability Sets, SQL Database, and a Virtual Network.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image18.png" title="Current scenario diagram" alt="The current scenario diagram for Contoso Financial has three users on the internet passing through an external load balancer to access the Availability Set (Web App) with two virtual machines. Both the first availability set, and a second availability set (background processes) pass through an internal load balancer to a third availability set (Web API). A SQL Database shares bi-directional access with the Web API availability set. All three availability sets are subnets of a VNet, which is in the Azure North Central US Region." /><figcaption>The current scenario diagram for Contoso Financial has three users on the internet passing through an external load balancer to access the Availability Set (Web App) with two virtual machines. Both the first availability set, and a second availability set (background processes) pass through an internal load balancer to a third availability set (Web API). A SQL Database shares bi-directional access with the Web API availability set. All three availability sets are subnets of a VNet, which is in the Azure North Central US Region.</figcaption>
</figure>
<p>You have also been provided with the following metrics showing the average CPU / RAM utilization of the Virtual Machines hosting the solution that are all on the Standard D3 pricing tier.</p>
<p>When calculating the pricing for the environment, there may be some differences depending if you use the prices listed in the Azure Portal or the Azure Pricing Calculator.</p>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image19.png" title="Standard D3 pricing tier" alt="In this Standard D3 pricing tier, the first row is Front-End Web App Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38 percent or RAM of 44 percent. The second row is the Back-End Web App Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56 percent or RAM of 31 percent. The third row is Back-end processing tier, which is CPU of 49 percent, and RAM of 25 percent. The bottom row, Database Server SQL Database: Preium P4, has no CPU or RAM information." /><figcaption>In this Standard D3 pricing tier, the first row is Front-End Web App Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38 percent or RAM of 44 percent. The second row is the Back-End Web App Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56 percent or RAM of 31 percent. The third row is Back-end processing tier, which is CPU of 49 percent, and RAM of 25 percent. The bottom row, Database Server SQL Database: Preium P4, has no CPU or RAM information.</figcaption>
</figure>
<p>Additionally, the Azure SQL Database is hosted using the Premium P4 pricing tier.</p>
<p>The VM sizes from the Existing architecture that was deployed using the ARM Template will be slightly different from the diagram above for this scenario. The reason for this was to make the ARM Template deployment quicker and cheaper while still deploying enough to allow you to perform the exercises in this lab.</p>
<h4 id="task-1-calculate-estimated-hosting-cost-of-existing-solution">Task 1: Calculate Estimated Hosting Cost of Existing Solution</h4>
<h6 id="tasks-to-complete">Tasks to complete</h6>
<ul>
<li><p>Calculate the estimated hosting cost of the existing architecture.</p>
<ul>
<li>Factor in the Virtual Machine instances and SQL Database of the Existing Architecture.</li>
</ul></li>
</ul>
<h6 id="exit-criteria">Exit criteria</h6>
<ul>
<li>Have an estimate of the total estimated Azure cost to hosting the sample application in the Existing Architecture.</li>
</ul>
<h4 id="task-2-calculate-estimated-hosting-cost-of-vms-with-reserved-instances">Task 2: Calculate Estimated Hosting Cost of VMs with Reserved Instances</h4>
<h6 id="tasks-to-complete-1">Tasks to complete</h6>
<ul>
<li><p>Calculate the estimated hosting cost of the existing architecture using Reserved Instances.</p>
<ul>
<li>Factor in the Virtual Machine instances and SQL Database of the Existing Architecture using Reserved Instances.</li>
</ul></li>
</ul>
<h6 id="exit-criteria-1">Exit criteria</h6>
<ul>
<li>Have an estimate of the total estimated Azure cost to hosting the sample application in the Existing Architecture using Reserved Instances.</li>
</ul>
<h4 id="task-3-estimate-necessary-app-service-tiers">Task 3: Estimate Necessary App Service Tiers</h4>
<h6 id="tasks-to-complete-2">Tasks to complete</h6>
<ul>
<li><p>Estimate the necessary Azure App Service Plan for hosting the sample application in Azure PaaS services.</p>
<ul>
<li>Factor in the App Service Plans / instances and SQL Database.</li>
</ul></li>
</ul>
<h6 id="exit-criteria-2">Exit criteria</h6>
<ul>
<li>Determine the appropriate App Service Plan pricing tier necessary to host the application while maintaining the ability to handle existing application load.</li>
</ul>
<h4 id="task-4-calculate-estimated-hosting-cost-of-azure-app-service">Task 4: Calculate Estimated Hosting Cost of Azure App Service</h4>
<h6 id="tasks-to-complete-3">Tasks to complete</h6>
<ul>
<li>Calculate the estimated hosting cost of the sample application using Azure App Service.</li>
</ul>
<h6 id="exit-criteria-3">Exit criteria</h6>
<ul>
<li>Have an estimate of the total estimated Azure cost to hosting the sample application using Azure App Service.</li>
</ul>
<h4 id="task-5-calculate-estimated-cost-savings">Task 5: Calculate Estimated Cost Savings</h4>
<h6 id="tasks-to-complete-4">Tasks to complete</h6>
<ul>
<li>Calculate the total estimated cost savings between the existing IaaS architecture and migrating to Azure App Service.</li>
</ul>
<h6 id="exit-criteria-4">Exit criteria</h6>
<ul>
<li>Determine both the Monthly and Annual cost savings comparing the cost of both the Existing Architecture and the new Azure App Service architecture.</li>
</ul>
<h2 id="exercise-2-integrate-traffic-manager">Exercise 2: Integrate Traffic Manager</h2>
<p>Contoso Financial needs new load balancing solutions implemented using Azure Traffic Manager. The existing architecture uses a Load Balancer, but that does not accommodate the growth of Contoso Financial appropriately where they will need to add additional hosting regions in Europe.</p>
<h4 id="help-references-1">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/services/load-balancer/">Azure Load Balancer</a></p>
<p><a href="https://azure.microsoft.com/en-us/services/virtual-network">Azure Traffic Manager</a></p>
<h4 id="task-1-create-traffic-manager">Task 1: Create Traffic Manager</h4>
<h6 id="tasks-to-complete-5">Tasks to complete</h6>
<ul>
<li>Setup Traffic Manager to point to the Front-end Web App tier of the sample application.</li>
</ul>
<h6 id="exit-criteria-5">Exit criteria</h6>
<ul>
<li>A Traffic Manager has been created in the Azure Subscription within the North Central US region.</li>
</ul>
<h4 id="task-2-point-traffic-manager-to-external-internet-load-balancer">Task 2: Point Traffic Manager to External / Internet Load Balancer</h4>
<h6 id="tasks-to-complete-6">Tasks to complete</h6>
<ul>
<li>Configure the Traffic Manager to integrate with the External Load Balancer for the Front-end Web App tier.</li>
</ul>
<h6 id="exit-criteria-6">Exit criteria</h6>
<ul>
<li>Have a Traffic Manager endpoint that can be used to access the Front-end Web App tier configured through the existing External Load Balancer.</li>
</ul>
<h2 id="exercise-3-setup-api-tier-in-azure-app-service">Exercise 3: Setup API Tier in Azure App Service</h2>
<h4 id="help-references-2">Help references</h4>
<p><a href="https://docs.microsoft.com/en-us/azure/app-service-api/app-service-api-apps-why-best-platform">API Apps overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-dotnet-get-started/">Deploy an ASP.NET web app to Azure App Service, using Visual Studio</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="task-1-create-app-service-for-web-api-tier">Task 1: Create App Service for Web API Tier</h4>
<h6 id="tasks-to-complete-7">Tasks to complete</h6>
<ul>
<li>Setup an App Service instance to use for hosting the Web API tier.</li>
</ul>
<h6 id="exit-criteria-7">Exit criteria</h6>
<ul>
<li>An App Service instance has been created in the North Central US region.</li>
</ul>
<h4 id="task-2-setup-app-settings">Task 2: Setup App Settings</h4>
<h6 id="tasks-to-complete-8">Tasks to complete</h6>
<ul>
<li>Setup the Application Settings to configure the Connection String named “TransactionDb” to contain the connection string for the sample applications SQL Database.</li>
</ul>
<h6 id="exit-criteria-8">Exit criteria</h6>
<ul>
<li>The Application Settings Connection String has been configured.</li>
</ul>
<h4 id="task-3-deploy-api-to-app-service">Task 3: Deploy API to App Service</h4>
<h6 id="tasks-to-complete-9">Tasks to complete</h6>
<ul>
<li>Deploy the API tier of the sample application (located within the Contoso.Financial.Api project within the Contoso.Financial Visual Studio solution in the HOL files) into the App Service Web App.</li>
</ul>
<h6 id="exit-criteria-9">Exit criteria</h6>
<ul>
<li>The API tier has been deployed and is accessible.</li>
</ul>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image20.png" title="Transaction API webpage" alt="The Transaction API webpage displays." /><figcaption>The Transaction API webpage displays.</figcaption>
</figure>
<h2 id="exercise-4-migrate-web-app-tier-to-app-service">Exercise 4: Migrate Web App Tier to App Service</h2>
<h4 id="help-references-3">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-web-overview/">Azure Web Apps overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-dotnet-get-started/">Deploy an ASP.NET web app to Azure App Service, using Visual Studio</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="task-1-create-app-service-for-web-app-tier">Task 1: Create App Service for Web App Tier</h4>
<h6 id="tasks-to-complete-10">Tasks to complete</h6>
<ul>
<li>Setup an App Service instance to use for hosting the Web App tier.</li>
</ul>
<h6 id="exit-criteria-10">Exit criteria</h6>
<ul>
<li>An App Service instance has been created in the North Central US region.</li>
</ul>
<h4 id="task-2-setup-app-settings-1">Task 2: Setup App Settings</h4>
<h6 id="tasks-to-complete-11">Tasks to complete</h6>
<ul>
<li>Setup the Application Settings to configure the App Setting named “transactionAPIUrl” to contain the URL to the API tier hosted in App Service.</li>
</ul>
<h6 id="exit-criteria-11">Exit criteria</h6>
<ul>
<li>The Application Settings App Setting has been configured.</li>
</ul>
<h4 id="task-3-deploy-app-to-web-app">Task 3: Deploy App to Web App</h4>
<h6 id="tasks-to-complete-12">Tasks to complete</h6>
<ul>
<li>Deploy the Web App tier of the sample application (located within the Contoso.Financial.Web project within the Contoso.Financial Visual Studio solution in the HOL files) into the App Service Web App.</li>
</ul>
<h6 id="exit-criteria-12">Exit criteria</h6>
<ul>
<li>The Web App Tier has been deployed and is accessible in a web browser.</li>
</ul>
<h4 id="task-4-add-web-app-to-traffic-manager">Task 4: Add Web App to Traffic Manager</h4>
<h6 id="tasks-to-complete-13">Tasks to complete</h6>
<ul>
<li><p>Configure a Traffic Manager Endpoint for the new App Service hosted Web App Tier of the application.</p></li>
<li><p>Remove the External Load Balancer Endpoint from the Traffic Manager.</p></li>
</ul>
<h6 id="exit-criteria-13">Exit criteria</h6>
<ul>
<li><p>The Traffic Manager Endpoint has been configured for the App Service Web App Tier, and it is accessible in a web browser.</p></li>
<li><p>The External Load Balancer Endpoint has been removed from Traffic Manager.</p></li>
</ul>
<figure>
<img src="images/Hands-onlabunguided-Optimizedarchitectureimages/media/image21.png" title="Contoso Financial login webpage" alt="The Contoso Financial login webpage displays." /><figcaption>The Contoso Financial login webpage displays.</figcaption>
</figure>
<h4 id="task-5-take-down-web-app-and-api-vms">Task 5: Take down Web App and API VMs</h4>
<h6 id="tasks-to-complete-14">Tasks to complete</h6>
<ul>
<li><p>Stop the Web App Tier Virtual Machines.</p></li>
<li><p>Stop the API tier Virtual Machines.</p></li>
</ul>
<h6 id="exit-criteria-14">Exit criteria</h6>
<ul>
<li>The Virtual Machines hosting the Web App and API tiers of the sample application are in a “Stopped (deallocated)” state.</li>
</ul>
<h2 id="exercise-5-migrate-background-tier-to-app-service">Exercise 5: Migrate Background Tier to App Service</h2>
<h4 id="help-references-4">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-webjobs-readme/%3E">Using WebJobs in Azure App Service</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-create-web-jobs/">Run Background tasks with WebJobs</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="task-1-create-app-service-for-background-tier">Task 1: Create App Service for Background Tier</h4>
<h6 id="tasks-to-complete-15">Tasks to complete</h6>
<ul>
<li>Setup an App Service instance to use for hosting the Background tier</li>
</ul>
<h6 id="exit-criteria-15">Exit criteria</h6>
<ul>
<li>An App Service instance has been created in the North Central US region.</li>
</ul>
<h4 id="task-2-setup-app-settings-2">Task 2: Setup App Settings</h4>
<h6 id="tasks-to-complete-16">Tasks to complete</h6>
<ul>
<li>Setup the Application Settings to configure the Connection String named “TransactionDb” to contain the connection string to the SQL Database.</li>
</ul>
<h6 id="exit-criteria-16">Exit criteria</h6>
<ul>
<li>The Application Settings Connection String has been configured.</li>
</ul>
<h4 id="task-3-deploy-app-to-app-service">Task 3: Deploy App to App Service</h4>
<h6 id="tasks-to-complete-17">Tasks to complete</h6>
<ul>
<li><p>Deploy the Background tier of the sample application (located within the Contoso.Financial.Background project within the Contoso.Financial Visual Studio solution in the HOL files) into the App Service Web App as a Web Job.</p></li>
<li><p>Configure the Web Job to be recurring and scheduled to run every <strong>1 Minutes</strong>.</p></li>
</ul>
<h6 id="exit-criteria-17">Exit criteria</h6>
<ul>
<li><p>The Background tier has been deployed.</p></li>
<li><p>The Background tier is scheduled to run every 1 minute.</p></li>
</ul>
<h4 id="task-4-take-down-background-tier-vm">Task 4: Take down Background Tier VM</h4>
<h6 id="tasks-to-complete-18">Tasks to complete</h6>
<ul>
<li>Stop the Background Tier Virtual Machine.</li>
</ul>
<h6 id="exit-criteria-18">Exit criteria</h6>
<ul>
<li>The Virtual Machine hosting the Background tier of the sample application is in a “Stopped (deallocated)” state.</li>
</ul>
<h2 id="exercise-6-setup-sql-database-geo-replication">Exercise 6: Setup SQL Database Geo-Replication</h2>
<h4 id="help-references-5">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/sql-database-technical-overview/">Introduction to SQL Database</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/sql-database-geo-replication-overview/">SQL Database Active Geo-Replication</a></p>
<h4 id="task-1-setup-sql-database-geo-replication">Task 1: Setup SQL Database Geo-Replication</h4>
<h6 id="tasks-to-complete-19">Tasks to complete</h6>
<ul>
<li>Configure the SQL Database with Active Geo-Replication.</li>
</ul>
<h6 id="exit-criteria-19">Exit criteria</h6>
<ul>
<li>The SQL Database has been configured with Active Geo-Replication.</li>
</ul>
<h2 id="exercise-7-take-down-old-architecture-resources">Exercise 7: Take down old architecture / resources</h2>
<h4 id="task-1-remove-old-vm-based-tiers">Task 1: Remove old VM-based tiers</h4>
<h6 id="tasks-to-complete-20">Tasks to complete</h6>
<ul>
<li>Remove all the Existing Architecture resources that are no longer being used after the migration to Azure PaaS services.</li>
</ul>
<h6 id="exit-criteria-20">Exit criteria</h6>
<ul>
<li><p>The Azure resources for the Virtual Network and Virtual Machines of the Existing Architecture have been removed.</p></li>
<li><p>The SQL Database remains.</p></li>
</ul>
<h2 id="exercise-8-setup-european-web-app-tier-instance">Exercise 8: Setup European Web App Tier Instance</h2>
<h4 id="task-1-create-european-app-service">Task 1: Create European App Service</h4>
<h6 id="tasks-to-complete-21">Tasks to complete</h6>
<ul>
<li>Setup an App Service instance to use for hosting the Web App tier in the Azure North Europe region.</li>
</ul>
<h6 id="exit-criteria-21">Exit criteria</h6>
<ul>
<li>An App Service instance has been created in the North Europe region.</li>
</ul>
<h4 id="task-2-set-app-settings">Task 2: Set App Settings</h4>
<h6 id="tasks-to-complete-22">Tasks to complete</h6>
<ul>
<li>Setup the Application Settings to configure the App Setting named “transactionAPIUrl” to contain the URL to the API tier hosted in App Service.</li>
</ul>
<h6 id="exit-criteria-22">Exit criteria</h6>
<ul>
<li>The Application Settings App Setting has been configured.</li>
</ul>
<h4 id="task-3-deploy-web-app-to-european-region">Task 3: Deploy Web App to European Region</h4>
<h6 id="tasks-to-complete-23">Tasks to complete</h6>
<ul>
<li>Deploy the Web App tier of the sample application (located within the Contoso.Financial.Web project within the Contoso.Financial Visual Studio solution in the HOL files) into the App Service Web App.</li>
</ul>
<h6 id="exit-criteria-23">Exit criteria</h6>
<ul>
<li>The Web App Tier has been deployed to the North Europe region and is accessible in a web browser.</li>
</ul>
<h4 id="task-4-add-european-region-to-traffic-manager">Task 4: Add European Region to Traffic Manager</h4>
<h6 id="tasks-to-complete-24">Tasks to complete</h6>
<ul>
<li>Configure a Traffic Manager Endpoint for the new App Service hosted Web App Tier of the application in the North Europe region.</li>
</ul>
<h6 id="exit-criteria-24">Exit criteria</h6>
<ul>
<li><p>The Traffic Manager Endpoint has been configured for the App Service Web App Tier, and is accessible in a web browser.</p></li>
<li><p>The Traffic Manager Endpoint for the App Service Web App Tier in the North Central US region remains.</p></li>
<li><p>The App is accessible through the Traffic Manager endpoint.</p></li>
</ul>
<h2 id="after-the-hands-on-lab">After the hands-on lab</h2>
<h4 id="task-1-delete-resources">Task 1: Delete Resources</h4>
<ol type="1">
<li>Now that the HOL is complete, go ahead and delete all the Resource Groups that were created for this HOL. You will no longer need those resources and it will be beneficial to clean up your Azure Subscription.</li>
</ol>
<p>You should follow all steps provided <em>after</em> attending the Hands-on lab.</p>
</body>
</html>
