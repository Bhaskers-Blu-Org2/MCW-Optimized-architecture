<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>MCW: Optimized Architecture – includes</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://opsgilitylabs.blob.core.windows.net/lablayout/labstyles.css"></link>
</head>
<body>
<h1 id="optimized-architecture">Optimized architecture</h1>
<h2 id="hands-on-lab-step-by-step">Hands-on lab step-by-step</h2>
<h2 id="march-2018">March 2018</h2>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#abstract-and-learning-objectives">Abstract and learning objectives</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#solution-architecture">Solution architecture</a></li>
<li><a href="#before-the-hands-on-lab">Before the hands-on lab</a>
<ul>
<li><a href="#task-1-create-a-virtual-machine-for-your-lab-environment">Task 1: Create a virtual machine for your lab environment</a></li>
<li><a href="#task-2-disable-ie-enhanced-security">Task 2: Disable IE Enhanced Security</a></li>
<li><a href="#task-3-download-the-sample-app-files">Task 3: Download the Sample App Files</a></li>
<li><a href="#task-4-deploy-sample-app-and-existing-environment">Task 4: Deploy Sample App and “Existing” environment</a></li>
</ul></li>
<li><a href="#exercise-1-determine-appropriate-app-service-tiers-and-estimate-cost-savings">Exercise 1: Determine Appropriate App Service Tiers and Estimate Cost Savings</a>
<ul>
<li><a href="#help-references">Help references</a></li>
<li><a href="#scenario">Scenario</a></li>
<li><a href="#task-1-calculate-estimated-hosting-cost-of-existing-solution">Task 1: Calculate Estimated Hosting Cost of Existing Solution</a></li>
<li><a href="#task-2-calculate-estimated-hosting-cost-of-vms-with-reserved-instances">Task 2: Calculate Estimated Hosting Cost of VMs with Reserved instances</a></li>
<li><a href="#task-3-estimate-necessary-app-service-tiers">Task 3: Estimate Necessary App Service Tiers</a></li>
<li><a href="#task-4-calculate-estimated-hosting-cost-of-azure-app-service">Task 4: Calculate Estimated Hosting Cost of Azure App Service</a></li>
<li><a href="#task-5-calculate-estimated-cost-savings">Task 5: Calculate Estimated Cost Savings</a></li>
</ul></li>
<li><a href="#exercise-2-integrate-traffic-manager">Exercise 2: Integrate Traffic Manager</a>
<ul>
<li><a href="#help-references-1">Help references</a></li>
<li><a href="#task-1-create-traffic-manager">Task 1: Create Traffic Manager</a></li>
<li><a href="#task-2-point-traffic-manager-to-external-internet-load-balancer">Task 2: Point Traffic Manager to External / Internet Load Balancer</a></li>
</ul></li>
<li><a href="#exercise-3-setup-api-tier-in-azure-app-service">Exercise 3: Setup API Tier in Azure App Service</a>
<ul>
<li><a href="#help-references-2">Help references</a></li>
<li><a href="#step-1-create-app-service-for-web-api-tier">Step 1: Create App Service for Web API Tier</a></li>
<li><a href="#step-2-setup-app-settings">Step 2: Setup App Settings</a></li>
<li><a href="#step-3-deploy-api-to-app-service">Step 3: Deploy API to App Service</a></li>
</ul></li>
<li><a href="#exercise-4-migrate-web-app-tier-to-app-service">Exercise 4: Migrate Web App Tier to App Service</a>
<ul>
<li><a href="#help-references-3">Help references</a></li>
<li><a href="#step-1-create-app-service-for-web-app-tier">Step 1: Create App Service for Web App Tier</a></li>
<li><a href="#step-2-setup-app-settings-1">Step 2: Setup App Settings</a></li>
<li><a href="#step-3-deploy-app-to-web-app">Step 3: Deploy App to Web App</a></li>
<li><a href="#step-4-add-web-app-to-traffic-manager">Step 4: Add Web App to Traffic Manager</a></li>
<li><a href="#step-5-take-down-web-app-and-api-vms">Step 5: Take down Web App and API VMs</a></li>
</ul></li>
<li><a href="#exercise-5-migrate-background-tier-to-app-service">Exercise 5: Migrate Background Tier to App Service</a>
<ul>
<li><a href="#help-references-4">Help references</a></li>
<li><a href="#step-1-create-app-service-for-background-tier">Step 1: Create App Service for Background Tier</a></li>
<li><a href="#step-2-setup-app-settings-2">Step 2: Setup App Settings</a></li>
<li><a href="#step-3-deploy-app-to-app-service">Step 3: Deploy App to App Service</a></li>
<li><a href="#step-4-take-down-background-tier-vm">Step 4: Take down Background Tier VM</a></li>
</ul></li>
<li><a href="#exercise-6-setup-sql-database-geo-replication">Exercise 6: Setup SQL Database Geo-Replication</a>
<ul>
<li><a href="#help-references-5">Help references</a></li>
<li><a href="#step-1-setup-sql-database-geo-replication">Step 1: Setup SQL Database Geo-Replication</a></li>
</ul></li>
<li><a href="#exercise-7-take-down-old-architecture-resources">Exercise 7: Take down old architecture resources</a>
<ul>
<li><a href="#step-1-remove-old-vm-based-tiers">Step 1: Remove Old VM-based tiers</a></li>
</ul></li>
<li><a href="#exercise-8-setup-european-web-app-tier-instance">Exercise 8: Setup European Web App Tier Instance</a>
<ul>
<li><a href="#help-references-6">Help references</a></li>
<li><a href="#step-1-create-european-app-service">Step 1: Create European App Service</a></li>
<li><a href="#step-2-set-app-settings">Step 2: Set App Settings</a></li>
<li><a href="#step-3-deploy-web-app-to-european-region">Step 3: Deploy Web App to European Region</a></li>
<li><a href="#step-4-add-european-region-to-traffic-manager">Step 4: Add European Region to Traffic Manager</a></li>
</ul></li>
<li><a href="#after-the-hands-on-lab">After the hands-on lab</a>
<ul>
<li><a href="#task-1-delete-resources">Task 1: Delete Resources</a></li>
</ul></li>
</ul>
<h2 id="abstract-and-learning-objectives">Abstract and learning objectives</h2>
<p>In this workshop, students will learn how to optimize a lift and shift style IaaS architecture in Azure to improve cost savings. You will also compare IaaS and PaaS hosting options to save cost even further using Azure App Service. Additionally, students will learn to improve resiliency and high availability through multi-region deployment.</p>
<p>Attendees will learn how to:</p>
<ul>
<li><p>Optimize Azure IaaS for cost savings</p></li>
<li><p>Migrate an Azure IaaS optimized</p></li>
<li><p>Compare cost between Azure IaaS versus Azure PaaS</p></li>
<li><p>Setup SQL Database geo-replication</p></li>
<li><p>Configure multi-region deployment</p></li>
</ul>
<h2 id="overview">Overview</h2>
<p>The Optimized Architecture hands-on lab (HOL) is a hands-on exercise that will challenge you to calculate Azure spending optimizations by comparing IaaS and PaaS services using a supplied sample application (a 3-tier application written in C# and ASP.NET MVC) that is based on Microsoft Azure IaaS services such as Virtual Machines, Virtual Network, Load Balancers, Storage and SQL Database. In addition to calculating estimated Azure cost of the existing architecture, you will need to calculate the estimated cost of hosting the sample application using Azure PaaS services. The scenario will include migrating the full sample application to be hosted on Azure PaaS services such as Azure App Service Web Apps, Web Jobs, and Traffic Manager as well as implementing a secondary hosting region for the Web App tier and database replication.</p>
<p>The HOL can be implemented on your own, but it is highly recommended to pair up with other members at the HOL to model a real-world experience much closer and to allow each member to share their expertise for the overall solutions.</p>
<h2 id="requirements">Requirements</h2>
<ol type="1">
<li><p>Microsoft Azure subscription</p></li>
<li><p>Local machine or a virtual machine configured with Visual Studio 2017 Community Edition or better</p></li>
</ol>
<h2 id="solution-architecture">Solution architecture</h2>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image2.png" title="Solution architecture" alt="Using traffic manager" /><figcaption>Using traffic manager</figcaption>
</figure>
<h2 id="before-the-hands-on-lab">Before the hands-on lab</h2>
<p>Duration: 20 minutes</p>
<p>In this exercise, you will set up an environment to use for the rest of the exercises.</p>
<h4 id="task-1-create-a-virtual-machine-for-your-lab-environment">Task 1: Create a virtual machine for your lab environment</h4>
<ol type="1">
<li><p>Launch a browser using incognite or in-private mode, and navigate to <a href="https://portal.azure.com" class="uri">https://portal.azure.com</a>. Once prompted, login with your Microsoft Azure credentials. If prompted, choose whether your account is an organization account or just a Microsoft Account.</p></li>
<li><p>Click on +NEW, and in the search box, type in Visual Studio Community 2017 on Windows Server 2016 (x64), and press enter. Click the Visual Studio Community 2017 image running on Windows Server 2016 and with the latest update.</p></li>
<li><p>In the returned search results, click the image name.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image3.png" title="Everything blade" alt="In the Everything blade, Visual Studio Community 2017 is typed in the Search field. Under Name, Visual Studio Community on Windows Server 2016 is circled." /><figcaption>In the Everything blade, Visual Studio Community 2017 is typed in the Search field. Under Name, Visual Studio Community on Windows Server 2016 is circled.</figcaption>
</figure></li>
<li><p>In the Marketplace solution blade, click <strong>Create</strong>.</p></li>
<li><p>Set the following configuration on the Basics tab, and click <strong>OK</strong>.</p>
<ul>
<li><p>Name: <strong>LABVM</strong></p></li>
<li><p>VM disk type: <strong>SSD</strong></p></li>
<li><p>User name: <strong>demouser</strong></p></li>
<li><p>Password: <strong>demo@pass123</strong></p></li>
<li><p>Subscription: <strong>If you have multiple subscriptions choose the subscription to execute your labs in.</strong></p></li>
<li><p>Resource Group: <strong>OPSLABRG</strong></p></li>
<li><p>Location: <strong>Choose the closest Azure region to you.</strong></p></li>
</ul></li>
<li><p>Choose the <strong>DS1_V2 Standard</strong> instance size on the Size blade.</p></li>
<li><p>Accept the remaining default values on the Settings blade, and click <strong>OK</strong>. On the Summary page, click <strong>OK</strong>. The deployment should begin provisioning. It may take more than 10 minutes for the virtual machine to complete provisioning.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image4.png" title="Deploying Visual Studio Community 2017 icon" alt="Screenshot of the Deploying Visual Studio Community 2017 icon." /><figcaption>Screenshot of the Deploying Visual Studio Community 2017 icon.</figcaption>
</figure></li>
</ol>
<h4 id="task-2-disable-ie-enhanced-security">Task 2: Disable IE Enhanced Security</h4>
<p>Note: Sometimes this image has IE ESC disabled. Sometimes it does not.</p>
<ol type="1">
<li><p>On the new VM, you just created, click the <strong>Server Manager</strong> icon.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image5.png" title="Server Manager icon" alt="Screenshot of the Server Manager icon." /><figcaption>Screenshot of the Server Manager icon.</figcaption>
</figure></li>
<li><p>Click <strong>Local Server</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image6.png" title="Server Manager icon drop-down menu" alt="Local Server is selected from the Server Manager icon drop-down menu." /><figcaption>Local Server is selected from the Server Manager icon drop-down menu.</figcaption>
</figure></li>
<li><p>On the right side of the pane, click <strong>On</strong> by IE Enhanced Security Configuration.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image7.png" title="IE Enhanced Security Configuration" alt="IE Enhanced Security Configuration is set to On." /><figcaption>IE Enhanced Security Configuration is set to On.</figcaption>
</figure></li>
<li><p>Change to <strong>Off</strong> for Administrators, and click <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image8.png" title="Internet Explorer Enhanced Security Configuration Dialog box" alt="In the Internet Explorer Enhanced Security Configuration Dialog box, Administrators is set to Off." /><figcaption>In the Internet Explorer Enhanced Security Configuration Dialog box, Administrators is set to Off.</figcaption>
</figure></li>
</ol>
<h4 id="task-3-download-the-sample-app-files">Task 3: Download the Sample App Files</h4>
<ol type="1">
<li><p>Create a new folder on your C: drive named <strong>HOL</strong>.</p></li>
<li><p>Download the sample application and ARM template (optimized-architecture-student.zip) from here: <a href="https://cloudworkshop.blob.core.windows.net/optimized-architecture/OptimizedArchitecture-StudentFiles-6-2017.zip" class="uri">https://cloudworkshop.blob.core.windows.net/optimized-architecture/OptimizedArchitecture-StudentFiles-6-2017.zip</a>.</p></li>
<li><p>Right click on the downloaded .zip file, and click <strong>Properties</strong>. On the properties pane, check <strong>Unblock</strong> to ensure the files are marked safe.</p></li>
<li><p>Extract the zip file contents to the <strong>HOL</strong> folder.</p></li>
<li><p>From the <strong>ARMTemplate</strong> folder under <strong>HOL</strong>, open the Visual Studio Solution file: <strong>Contoso.Financial.ARMTemplate.sln</strong>.</p></li>
</ol>
<h4 id="task-4-deploy-sample-app-and-existing-environment">Task 4: Deploy Sample App and “Existing” environment</h4>
<ol type="1">
<li><p>From the <em>C:\HOL\ARMTemplate</em> folder, open the Visual Studio Solution: <strong>Contoso.Financial.ARMTemplate.sln</strong></p></li>
<li><p>In the <strong>Solution Explorer</strong> window, right-click on the <strong>Contoso.Financial.ARMTemplate</strong> project, click <strong>Deploy</strong>, and then click <strong>New…<br />
</strong><br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image9.png" title="Solution Explorer" alt="In Solution Explorer, Contoso.Financial.ARMTemplate is selected. From its right-click menu, Deploy / New is selected." /></p></li>
<li><p>If your Microsoft or Organization account for your Azure Subscription has not been added to Visual Studio yet, click on <strong>Add an account</strong>, then <strong>Add an account…</strong>, and follow the prompts to login.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image10.png" title="Deploy to Resource Group dialog box" alt="Add an account is selected in the Deploy to Resource Group dialog box." /><figcaption>Add an account is selected in the Deploy to Resource Group dialog box.</figcaption>
</figure></li>
<li><p>Click on the <strong>Resource group</strong> dropdown, followed by selecting <strong>&lt;Create New…&gt;</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image11.png" title="Deploy to Resource Group dialog box" alt="In the Deploy to Resource Group dialog box, Create New is selected from the Resource group drop-down menu." /><figcaption>In the Deploy to Resource Group dialog box, Create New is selected from the Resource group drop-down menu.</figcaption>
</figure></li>
<li><p>On the <strong>Create Resource Group</strong> dialog, enter the following values:</p>
<ul>
<li><p>Resource group name: <strong>ContosoExistingRG</strong></p></li>
<li><p>Resource group location: <strong>North Central US (note if your subscription allows this otherwise pick up subscription where you are allowed to deploy to)</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image12.png" title="Create Resource Group dialog box" alt="Fields in the Create Resource Group dialog box are set to the previously defined settings." /><figcaption>Fields in the Create Resource Group dialog box are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click the <strong>Create</strong> button.</p></li>
<li><p>In the <strong>Deploy to Resource Group</strong> dialog, click the <strong>Deploy</strong> button to deploy the ARM Template to the newly created Resource Group.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image13.png" title="Deploy to Resource Group dialog box" alt="In the Deploy to Resource Group dialog box, the Deploy button is selected." /><figcaption>In the Deploy to Resource Group dialog box, the Deploy button is selected.</figcaption>
</figure></li>
<li><p>Deployment status of the ARM Template will be displayed in the <strong>Output</strong> window within Visual Studio.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image14.png" title="Visual Studio Output Window" alt="Deployment status displays in the Visual Studio Output Window." /><figcaption>Deployment status displays in the Visual Studio Output Window.</figcaption>
</figure></li>
<li><p>Once the deployment has completed successfully, the <strong>IP Address</strong> and <strong>FQDN</strong> of the External / Internet Load Balancer for the Web App tier will be displayed in the output window.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image15.png" title="Output Window" alt="The IP Address for the External / Internal Load Balancer are circled in the Output Window." /><figcaption>The IP Address for the External / Internal Load Balancer are circled in the Output Window.</figcaption>
</figure></li>
</ol>
<blockquote>
<p>The <strong>Username</strong> and <strong>Password</strong> for the VMs and SQL Database created by the ARM Template are: - Username: <strong>demouser</strong> - Password: demo@pass123</p>
</blockquote>
<ol start="10" type="1">
<li><p>Open a new <strong>Web Browser</strong> window, and navigate to the Web App tier using the <strong>Internet Load Balancer IP Address</strong>.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image16.png" title="Contoso Financial Login webpage" alt="The Contoso Financial Login webpage displays." /></p></li>
<li><p>To login to the Web App Tier of the Contoso Financial sample application, simply enter <strong>any email address and password</strong> followed by clicking on <strong>Sign in</strong>. If you can’t immediately sign in, give the site a few minutes to run the background process and then attempt to sign in again.</p></li>
<li><p>Once logged in, the sample application will display a simple <strong>Account Transaction</strong> ledger.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image17.png" title="Contoso Financial Account Overview webpage" alt="The Contoso Financial Account Overview webpage displays with Transaction details in an account transaction ledger." /></p></li>
</ol>
<blockquote>
<p>Leaving the browser open to the Account Overview page will automatically load new transactions as they are generated by the background process, since the web page has a JavaScript timer that checks for new transactions periodically. You should follow all steps provided <strong>before</strong> attending the HOL.</p>
</blockquote>
<h2 id="exercise-1-determine-appropriate-app-service-tiers-and-estimate-cost-savings">Exercise 1: Determine Appropriate App Service Tiers and Estimate Cost Savings</h2>
<p>Contoso Financial has asked you to optimize their Azure spending by migrating their existing Azure IaaS based architecture over to Azure PaaS services. You will need to determine the appropriate hosting tiers and estimate the total cost savings on a monthly and annual basis.</p>
<h4 id="help-references">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/pricing/calculator">Azure Pricing Calculator</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machines/">Virtual Machines Pricing</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/app-service">App Service Pricing</a></p>
<h4 id="scenario">Scenario</h4>
<p>Contoso Financial recently performed a lift-and-shift to move their application into Microsoft Azure using the North Central US region. As a result, the existing architecture of the application is implemented with Virtual Machines, Load Balancers, Availability Sets, SQL Database, and a Virtual Network.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image18.png" title="Current scenario diagram" alt="The current scenario diagram for Contoso Financial has three users on the internet passing through an external load balancer to access the Availability Set (Web App) with two virtual machines. Both the first availability set, and a second availability set (background processes) pass through an internal load balancer to a third availability set (Web API). A SQL Database shares bi-directional access with the Web API availability set. All three availability sets are subnets of a VNet, which is in the Azure North Central US Region." /><figcaption>The current scenario diagram for Contoso Financial has three users on the internet passing through an external load balancer to access the Availability Set (Web App) with two virtual machines. Both the first availability set, and a second availability set (background processes) pass through an internal load balancer to a third availability set (Web API). A SQL Database shares bi-directional access with the Web API availability set. All three availability sets are subnets of a VNet, which is in the Azure North Central US Region.</figcaption>
</figure>
<p>You have also been provided with the following metrics showing the average CPU / RAM utilization of the Virtual Machines hosting the solution that are all on the Standard D3 pricing tier.</p>
<p>When calculating the pricing for the environment, there may be some differences depending if you use the prices listed in the Azure Portal or the Azure Pricing Calculator.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image19.png" title="Standard D3 pricing tier" alt="In this Standard D3 pricing tier, the first row is Front-End Web App Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38 percent or RAM of 44 percent. The second row is the Back-End Web App Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56 percent or RAM of 31 percent. The third row is Back-end processing tier, which is CPU of 49 percent, and RAM of 25 percent. The bottom row, Database Server SQL Database: Premium P4, has no CPU or RAM information." /><figcaption>In this Standard D3 pricing tier, the first row is Front-End Web App Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38 percent or RAM of 44 percent. The second row is the Back-End Web App Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56 percent or RAM of 31 percent. The third row is Back-end processing tier, which is CPU of 49 percent, and RAM of 25 percent. The bottom row, Database Server SQL Database: Premium P4, has no CPU or RAM information.</figcaption>
</figure>
<p>Additionally, the Azure SQL Database is hosted using the Premium P4 pricing tier.</p>
<p>The VM sizes from the Existing architecture that was deployed using the ARM Template will be slightly different from the diagram above for this scenario. The reason for this was to make the ARM Template deployment quicker and cheaper while still deploying enough to allow you to perform the exercises in this lab.</p>
<h4 id="task-1-calculate-estimated-hosting-cost-of-existing-solution">Task 1: Calculate Estimated Hosting Cost of Existing Solution</h4>
<ol type="1">
<li><p>From a new browser tab or instance, navigate to the <strong>Azure Pricing Calculator</strong> <a href="https://azure.microsoft.com/en-us/pricing/calculator" class="uri">https://azure.microsoft.com/en-us/pricing/calculator</a>.</p></li>
<li><p>Click on <strong>Compute</strong>, followed by <strong>Virtual Machines</strong>.</p>
<p><br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image20.png" title="Azure Pricing Calculator webpage" alt="On the Azure Pricing Calculator webpage, Compute and Virtual Machines are selected." /></p></li>
<li><p>Click on <strong>Databases</strong>, followed by <strong>SQL Database</strong>.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image21.png" title="Azure Pricing Calculator webpage" alt="On the Azure Pricing Calculator webpage, Databases and SQL Database are selected." /></p></li>
<li><p>Scroll down to the <strong>Your Estimate</strong> section of the page.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image22.png" title="Your Estimate section" alt="The Your Estimate section displays." /><figcaption>The Your Estimate section displays.</figcaption>
</figure></li>
<li><p>On the <strong>SQL Database</strong>, set the following values:</p>
<ul>
<li><p>Region: <strong>North Central US</strong></p></li>
<li><p>Pricing Tier: <strong>Premium</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image23.png" title="SQL Databases section" alt="In the SQL Database section, North Central US is selected for the region, and Premium is selected for the Tier." /><figcaption>In the SQL Database section, North Central US is selected for the region, and Premium is selected for the Tier.</figcaption>
</figure></li>
<li><p>Set the <strong>Performance Level</strong> to <strong>P4</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image24.png" title="Performance Level Field" alt="The Performance Level field is set to P4: 500 DTUs, 500 GB included storage per DB, $2.5000/hour" /><figcaption>The Performance Level field is set to P4: 500 DTUs, 500 GB included storage per DB, $2.5000/hour</figcaption>
</figure></li>
<li><p>On <strong>Virtual Machines</strong>, set the following values:</p>
<ul>
<li><p>Region: <strong>North Central US</strong></p></li>
<li><p>Pricing Tier: <strong>Standard</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image25.png" title="Virtual Machines section" alt="Under Virtual Machines, Region is set to North Central US&lt; and Tier is Standard." /><figcaption>Under Virtual Machines, Region is set to North Central US&lt; and Tier is Standard.</figcaption>
</figure></li>
<li><p>Change the <strong>Instance Size</strong> to <strong>D3</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image26.png" title="Instance field" alt="The Instance field is set to D3: 4 vCPU(s), 14 GB RAM, 200 GB Temporary storage, $0.560/hour." /><figcaption>The Instance field is set to D3: 4 vCPU(s), 14 GB RAM, 200 GB Temporary storage, $0.560/hour.</figcaption>
</figure></li>
<li><p>Change the <strong>Billing Option</strong> to <strong>Pay as you go</strong>, and change the <strong>Virtual Machines Count</strong> to <strong>5</strong>. The count now includes the 2x Web App Tier, 2x API Tier, and 1x Background Tier virtual machines.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image27.png" title="Billing Option section" alt="Under Billing Option, Pay as you go is selected. The number of virtual machines is set to 5, multiplied by 732 hours, for a total of $2,049.60." /><figcaption>Under Billing Option, Pay as you go is selected. The number of virtual machines is set to 5, multiplied by 732 hours, for a total of $2,049.60.</figcaption>
</figure></li>
<li><p>Click the <strong>Collapse all</strong> button, and Record the <strong>Estimated monthly cost</strong>. This is the total estimated cost of the existing environment Virtual Machines and SQL Database only.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image28.png" title="Your Estimate page" alt="On the Your Estimate page, the estimate of $3,879.60 in US Dollars is circled, as is the collapse all button (two arrows in a circle pointing in toward each other)." /><figcaption>On the Your Estimate page, the estimate of $3,879.60 in US Dollars is circled, as is the collapse all button (two arrows in a circle pointing in toward each other).</figcaption>
</figure></li>
</ol>
<h4 id="task-2-calculate-estimated-hosting-cost-of-vms-with-reserved-instances">Task 2: Calculate Estimated Hosting Cost of VMs with Reserved instances</h4>
<ol type="1">
<li><p>From a new browser tab or instance, navigate to the <strong>Azure Pricing Calculator</strong> <a href="https://azure.microsoft.com/en-us/pricing/calculator" class="uri">https://azure.microsoft.com/en-us/pricing/calculator</a>.</p></li>
<li><p>Click on <strong>Compute</strong>, followed by <strong>Virtual Machines</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image20.png" title="Azure Pricing Calculator webpage" alt="On the Azure Pricing Calculator webpage, Compute, and Virtual Machines are selected." /><figcaption>On the Azure Pricing Calculator webpage, Compute, and Virtual Machines are selected.</figcaption>
</figure></li>
<li><p>Click on <strong>Databases</strong>, followed by <strong>SQL Database</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image21.png" title="Azure Pricing Calculator webpage" alt="On the Azure Pricing Calculator webpage, Databases, and SQL Database are selected." /><figcaption>On the Azure Pricing Calculator webpage, Databases, and SQL Database are selected.</figcaption>
</figure></li>
<li><p>Scroll down to the <strong>Your Estimate</strong> section of the page.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image22.png" title="Azure Pricing Calculator webpage" alt="On the Azure Pricing Calculator webpage, the Your Estimate section displays." /><figcaption>On the Azure Pricing Calculator webpage, the Your Estimate section displays.</figcaption>
</figure></li>
<li><p>On the <strong>SQL Database</strong>, set the following values:</p>
<ul>
<li><p>Region: <strong>North Central US</strong></p></li>
<li><p>Pricing Tier: <strong>Premium</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image23.png" title="SQL Database section" alt="In the SQL Database section, Region is set to North Central US, and Tier is Premium." /><figcaption>In the SQL Database section, Region is set to North Central US, and Tier is Premium.</figcaption>
</figure></li>
<li><p>Set the <strong>Performance Level</strong> to <strong>P4</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image24.png" title="Performance Level field" alt="The Performance Level field is set to P4: 500 DTUs, 500 GB included storage per DB, $2.5000/hour." /><figcaption>The Performance Level field is set to P4: 500 DTUs, 500 GB included storage per DB, $2.5000/hour.</figcaption>
</figure></li>
<li><p>On <strong>Virtual Machines</strong>, set the following values:</p>
<ul>
<li><p>Region: <strong>North Central US</strong></p></li>
<li><p>Pricing Tier: <strong>Standard</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image25.png" title="Virtual Machines section" alt="In the SQL Database section, Region is set to North Central US, and Tier is Standard." /><figcaption>In the SQL Database section, Region is set to North Central US, and Tier is Standard.</figcaption>
</figure></li>
<li><p>Change the <strong>Instance Size</strong> to <strong>D3</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image26.png" title="Instance field" alt="The Instance field is set to D3: 4 vCPU(s), 14 GB RAM, 200 GB Temporary storage, $0.560/hour." /><figcaption>The Instance field is set to D3: 4 vCPU(s), 14 GB RAM, 200 GB Temporary storage, $0.560/hour.</figcaption>
</figure></li>
<li><p>Change the <strong>Billing Option</strong> to <strong>3-year reserved</strong>, and change the <strong>Virtual Machines Count</strong> to <strong>5</strong>, so the count includes the 2x Web App Tier, 2x API Tier, and 1x Background Tier virtual machines.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image29.png" title="Billing Option section" alt="In the Billing Option section, the 3 year reserved option is selected. Virtual machines is set to 5, and the total amount is $1,054.83." /><figcaption>In the Billing Option section, the 3 year reserved option is selected. Virtual machines is set to 5, and the total amount is $1,054.83.</figcaption>
</figure></li>
<li><p>Click the <strong>Collapse all</strong> button, and Record the <strong>Estimated monthly cost</strong>. This is the total estimated cost of the existing environment Virtual Machines and SQL Database only using <strong>Reserved Instances</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image30.png" title="Your Estimate page" alt="On the Your Estimate page, the collapse all button is selected. Below that, the the SQL Database cost is $1,830.00, the Virtual Machines are $1,054.83, and the estimated monthly cost is $2,884.83." /><figcaption>On the Your Estimate page, the collapse all button is selected. Below that, the the SQL Database cost is $1,830.00, the Virtual Machines are $1,054.83, and the estimated monthly cost is $2,884.83.</figcaption>
</figure></li>
</ol>
<h4 id="task-3-estimate-necessary-app-service-tiers">Task 3: Estimate Necessary App Service Tiers</h4>
<h5 id="subtask-1-find-existing-vm-instance-size-specifications-cpu-cores-and-ram">Subtask 1: Find Existing VM Instance Size Specifications (CPU Cores and RAM)</h5>
<ol type="1">
<li><p>From a new browser tab or instance, navigate to the <strong>Windows</strong> <strong>Virtual Machines Pricing</strong> page.<br />
<a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machines/windows/" class="uri">https://azure.microsoft.com/en-us/pricing/details/virtual-machines/windows/</a></p></li>
<li><p>Scroll down to the <strong>Explore all VM options</strong> section of the page.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image31.png" title="Windows Virtual Machines Pricing webpage" alt="The Explore all VM options section of the Windows Virtual Machines Pricing webpage displays." /><figcaption>The Explore all VM options section of the Windows Virtual Machines Pricing webpage displays.</figcaption>
</figure></li>
<li><p>Set the <strong>OS/Software</strong> drop down to <strong>Windows OS</strong>, and the <strong>Region</strong> to <strong>North Central US</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image32.png" title="Explore all VM options section" alt="In the Explore all VM options section, OS/Software is set to Windows OS, Region is North Central US, and Pricing will be displayed by hour." /><figcaption>In the Explore all VM options section, OS/Software is set to Windows OS, Region is North Central US, and Pricing will be displayed by hour.</figcaption>
</figure></li>
<li><p>Click on <strong>General purpose</strong>.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image33.png" title="Explore all VM options section" alt="At the bottom of the Explore all VM options section, the General purpose category is selected." /></p></li>
<li><p>Scroll down below the VM Instance Size listings, and click on the <strong>Check the Previous Generation page…</strong> link.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image34.png" title="Check the Previous Generation page link" alt="Screenshot of the Check the Previous Generation page for … link" /><figcaption>Screenshot of the Check the Previous Generation page for … link</figcaption>
</figure></li>
<li><p>Scroll down to the <strong>D1-4 v1</strong> section and make note of the VM Instance specs, specifically the <strong>CPU Cores</strong> and <strong>RAM</strong> for the <strong>D3</strong> instance size.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image35.png" title="D1-4 - v1 section" alt="In the D1-4 - v1 section, The D3 instance is circled, with the following values: vCPU, 4; RAM, 14.00GiB; Temporary Storage, 200GiB." /><figcaption>In the D1-4 - v1 section, The D3 instance is circled, with the following values: vCPU, 4; RAM, 14.00GiB; Temporary Storage, 200GiB.</figcaption>
</figure></li>
</ol>
<h5 id="subtask-2-calculate-web-app-tier-vm-utilization">Subtask 2: Calculate Web App Tier VM Utilization</h5>
<ol type="1">
<li><p>Calculate the <strong>Average CPU Utilization</strong> between the 2 Web App Tier VMs with individual CPU utilization of <strong>36%</strong> and <strong>38%</strong>.</p>
<ul>
<li><p>36 + 38 = 74</p></li>
<li><p>74 / 2 = <strong>37% Average CPU Utilization</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image36.png" title="Front-end Web App Tier percentages" alt="The Front-end Web App Tier percentages for VM Size Standard D3, CPU is 36 percent and RAM 46 percent, or CPU 38 percent and RAM 44 percent." /><figcaption>The Front-end Web App Tier percentages for VM Size Standard D3, CPU is 36 percent and RAM 46 percent, or CPU 38 percent and RAM 44 percent.</figcaption>
</figure></li>
<li><p>Calculate the amount of <strong>CPU Cores</strong> the <strong>Average CPU Utilization</strong> represents:</p>
<ul>
<li><strong>4</strong> (CPU Cores) <strong>* 0.37</strong> (37%) = 1.48 CPU Cores</li>
</ul></li>
<li><p>Calculate the <strong>Average RAM Utilization</strong> between the 2 Web App Tier VMs with individual RAM Utilization of <strong>46%</strong> and <strong>44%</strong>.</p>
<ul>
<li><p>46 + 44 = 90</p></li>
<li><p>90 / 2 = <strong>45% Average RAM Utilization</strong></p></li>
</ul></li>
<li><p>Calculate the amount of <strong>RAM</strong> the <strong>Average RAM Utilization</strong> represents:</p>
<ul>
<li><strong>14 GB</strong> (RAM) <strong>* 0.45</strong> (45%) <strong>= 6.3 GB RAM</strong></li>
</ul></li>
</ol>
<h5 id="subtask-3-calculate-api-tier-vm-utilization">Subtask 3: Calculate API Tier VM Utilization</h5>
<ol type="1">
<li><p>Calculate the <strong>Average CPU Utilization</strong> between the 2 API Tier VMs with individual CPU utilization of <strong>58%</strong> and <strong>56%</strong>.</p>
<ul>
<li><p>58 + 56 = 114</p></li>
<li><p>114 / 2 = <strong>57% Average CPU Utilization</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image37.png" title="Back-end Web App Tier percentages" alt="The Back-end Web App Tier percentages for VM Size Standard D3, CPU is 58 percent and RAM 34 percent, or CPU 56 percent and RAM 31 percent." /><figcaption>The Back-end Web App Tier percentages for VM Size Standard D3, CPU is 58 percent and RAM 34 percent, or CPU 56 percent and RAM 31 percent.</figcaption>
</figure></li>
<li><p>Calculate the amount of <strong>CPU Cores</strong> the <strong>Average CPU Utilization</strong> represents:</p>
<ul>
<li><strong>4</strong> (CPU Cores) <strong>* 0.57</strong> (57%) <strong>= 2.28 CPU Cores</strong></li>
</ul></li>
<li><p>Calculate the <strong>Average RAM Utilization</strong> between the 2 API Tier VMs with individual RAM utilization of <strong>34%</strong> and <strong>31%</strong>.</p>
<ul>
<li><p>34 + 31 = 65</p></li>
<li><p>65 / 2 = <strong>32.5% Average RAM Utilization</strong></p></li>
</ul></li>
<li><p>Calculate the amount of <strong>RAM</strong> the <strong>Average RAM Utilization</strong> represents:</p>
<ul>
<li><strong>14 GB</strong> (RAM) <strong>* 0.325</strong> (32.5%) <strong>= 4.55 GB RAM</strong></li>
</ul></li>
</ol>
<h5 id="subtask-4-calculate-background-tier-vm-utilization">Subtask 4: Calculate Background Tier VM Utilization</h5>
<ol type="1">
<li><p>The <strong>Average CPU Utilization</strong> of the single Background Tier VM is <strong>49%</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image38.png" alt="The Back-end Processing Tier percentages for VM Size Standard D3, CPU is 49 percent and RAM 25 percent." /><figcaption>The Back-end Processing Tier percentages for VM Size Standard D3, CPU is 49 percent and RAM 25 percent.</figcaption>
</figure></li>
<li><p>Calculate the amount of <strong>CPU Cores</strong> the <strong>Average CPU Utilization</strong> represents:</p>
<ol type="a">
<li><strong>4</strong> (CPU Cores) <strong>* 0.49</strong> (49%) <strong>= 1.96 CPU Cores</strong></li>
</ol></li>
<li><p>The <strong>Average RAM Utilization</strong> of the single Background Tier VM is <strong>25%</strong>.</p></li>
<li><p>Calculate the amount of <strong>RAM</strong> the <strong>Average RAM Utilization</strong> represents:</p>
<ol type="a">
<li><strong>14 GB</strong> (RAM) <strong>* 0.25</strong> (25%) <strong>= 3.5 GB RAM</strong></li>
</ol></li>
</ol>
<h5 id="subtask-5-identify-appropriate-app-service-tier">Subtask 5: Identify Appropriate App Service Tier</h5>
<ol type="1">
<li><p>From a new browser tab or instance, navigate to the <strong>App Service Pricing</strong> page <a href="https://azure.microsoft.com/en-us/pricing/details/app-service" class="uri">https://azure.microsoft.com/en-us/pricing/details/app-service</a></p></li>
<li><p>Set the <strong>Region</strong> filter to <strong>North Central US</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image39.png" title="App Service Pricing page" alt="On the the App Service Pricing page, Region is set to North Central US, and Currency is US Dollar ($)." /><figcaption>On the the App Service Pricing page, Region is set to North Central US, and Currency is US Dollar ($).</figcaption>
</figure></li>
<li><p>Scroll down to the <strong>Standard Service Plan</strong> section.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image40.png" title="Standard Service Plan section" alt="The Standard Service Plan section displays a table of service plan instances, and corresponding number of cores, amount of ram and storage, and prices. Instance S1 has 1 core, 1.75 GB RAM, 50 GB storage, and costs $0.10/hour. Instance S2 has 2 cores, 3.50 GB RAM, 50 GB storage, and costs $0.20/hour. Instance S3 has 4 cores, 7 gb RAM, 50 GB storage, and costs $0.40/hour." /><figcaption>The Standard Service Plan section displays a table of service plan instances, and corresponding number of cores, amount of ram and storage, and prices. Instance S1 has 1 core, 1.75 GB RAM, 50 GB storage, and costs $0.10/hour. Instance S2 has 2 cores, 3.50 GB RAM, 50 GB storage, and costs $0.20/hour. Instance S3 has 4 cores, 7 gb RAM, 50 GB storage, and costs $0.40/hour.</figcaption>
</figure></li>
<li><p>Map the <strong>CPU / RAM</strong> <strong>Utilization</strong> of the <strong>Web App Tier</strong> <strong>(1.48 CPU Cores / 6.3 GB RAM)</strong> to the closest <strong>Standard Service Plan</strong> tier. These maps to be the <strong>Standard S3</strong> pricing tier.</p></li>
<li><p>Map the <strong>CPU / RAM</strong> <strong>Utilization</strong> of the <strong>API Tier</strong> <strong>(2.28 CPU Cores / 4.55 GB RAM)</strong> to the closest <strong>Standard Service Plan</strong> tier. These maps to be the <strong>Standard S3</strong> pricing tier.</p></li>
<li><p>Map the <strong>CPU / RAM</strong> <strong>Utilization</strong> of the <strong>Background Tier</strong> <strong>(1.96 CPU Cores / 3.5 GB RAM)</strong> to the closest <strong>Standard Service Plan</strong> tier. These maps to be the <strong>Standard S3</strong> pricing tier.</p>
<blockquote>
<p>The <strong>Background Tier</strong> matches almost identical to 100% of the CPU / RAM resources of the <strong>Standard S2</strong> pricing tier. However, 100% utilization would hinder the performance of the server since the resources would be at their maximum. For this reason, it is appropriate to go with the <strong>Standard S3</strong> pricing tier instead to leave extra room for best performance and possible spikes in load / usage.</p>
</blockquote></li>
<li><p>Overall, it has been identified that the <strong>Standard S3</strong> is the appropriate <strong>App Service Plan</strong> pricing tier to use for the Web App, API, and Background tiers.</p></li>
</ol>
<h4 id="task-4-calculate-estimated-hosting-cost-of-azure-app-service">Task 4: Calculate Estimated Hosting Cost of Azure App Service</h4>
<ol type="1">
<li><p>From a new browser tab or instance, navigate to the <strong>Azure Pricing Calculator</strong> <a href="https://azure.microsoft.com/en-us/pricing/calculator" class="uri">https://azure.microsoft.com/en-us/pricing/calculator</a></p></li>
<li><p>Click on <strong>App Service</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image41.png" title="Azure Pricing Calculator webpage" alt="On the Azure Pricing Calculator webpage, Featured and App Service are both selected." /><figcaption>On the Azure Pricing Calculator webpage, Featured and App Service are both selected.</figcaption>
</figure></li>
<li><p>If the <strong>SQL Database</strong> is not in the calculator from the previous VM estimation, scroll up, add it, and set it to <strong>Premium P4</strong> performance level.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image42.png" title="SQL Database section" alt="The SQL Database section displays with the following settings Region, East US; Type, Single Database; Tier, Premium; Performance Level, P4: 500 DTUs, 500 GB included storage per DB, $2.5000/hour. 1 Database multiplied by 732 hours equals $1,830.00." /><figcaption>The SQL Database section displays with the following settings Region, East US; Type, Single Database; Tier, Premium; Performance Level, P4: 500 DTUs, 500 GB included storage per DB, $2.5000/hour. 1 Database multiplied by 732 hours equals $1,830.00.</figcaption>
</figure></li>
<li><p>On <strong>App Service</strong>, change the <strong>Region</strong> to <strong>North Central US</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image43.png" title="App Service section" alt="In the App Service section, Region is set to North Central US." /><figcaption>In the App Service section, Region is set to North Central US.</figcaption>
</figure></li>
<li><p>Change the <strong>Tier</strong> to <strong>Standard</strong> and the <strong>Instance Size</strong> to <strong>S3</strong> to reflect the App Service Plan tier identified as the appropriate hosting tier for the Web App, API, and Background application tiers.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image44.png" title="App Service Section" alt="In the App Service Section, Region is North Central US, Tier is Standard, and Instance is S3: 4 vCPU(s), 7 GB RAM, 50 GB Storage, $0.400." /><figcaption>In the App Service Section, Region is North Central US, Tier is Standard, and Instance is S3: 4 vCPU(s), 7 GB RAM, 50 GB Storage, $0.400.</figcaption>
</figure></li>
<li><p>Change the <strong>Instances</strong> count to <strong>5</strong> to reflect the same number of instances of the existing VM architecture (2x Web App Tier, 2x API Tier, 1x Background Tier).</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image45.png" title="App Service section" alt="At the bottom of the App Service Section, 5 instances multiplied by 732 hours equals $1,464.00." /><figcaption>At the bottom of the App Service Section, 5 instances multiplied by 732 hours equals $1,464.00.</figcaption>
</figure>
<blockquote>
<p>The <strong>Instance Count</strong> should remain <strong>5</strong> since the application will still need the same amount of resources to host; it is just the Azure Service hosting them that is changing. For example, since the Web App Tier needs 2 VM instances, the App Service Plan will also use 2 instances for hosting.</p>
</blockquote></li>
<li><p>Record the <strong>Estimated monthly cost</strong>. This is the total estimated cost of the new environment App Service Instances and SQL Database only.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image46.png" title="Your Estimate page" alt="On the Your Estimate page, the the App Service cost is $1,464.00, the SQL Database cost is $1,830.00, and the estimated monthly cost is $3,294.00." /><figcaption>On the Your Estimate page, the the App Service cost is $1,464.00, the SQL Database cost is $1,830.00, and the estimated monthly cost is $3,294.00.</figcaption>
</figure></li>
</ol>
<h4 id="task-5-calculate-estimated-cost-savings">Task 5: Calculate Estimated Cost Savings</h4>
<ol type="1">
<li><p>Copy the <strong>Estimated Cost</strong> of the <strong>Existing Architecture</strong> (VMs and SQL Database).</p>
<blockquote>
<p>The original <strong>Existing Architecture</strong> cost that was estimated came to approximately <strong>$6,902</strong>. Your estimate may vary, depending on current Azure pricing.</p>
</blockquote></li>
<li><p>Copy the <strong>Estimated Cost</strong> of the <strong>New Architecture</strong> (App Service and SQL Database).</p>
<blockquote>
<p>The <strong>New Architecture</strong> cost that was estimated came to approximately <strong>$3,582</strong>. Your estimate may vary, depending on current Azure pricing.</p>
</blockquote></li>
<li><p><strong>Subtract</strong> the estimated cost of the <strong>New Architecture</strong> from the <strong>Existing Architecture</strong> to calculate the <strong>Estimated Monthly Cost Savings</strong>.</p>
<ul>
<li>Existing – New = Estimated Monthly Cost Savings</li>
</ul>
<blockquote>
<p>From the estimates above this would be: $6,902 - $3,582 = $3,320 Remember your results may vary, depending on current Azure pricing.</p>
</blockquote></li>
<li><p>To calculate the <strong>Annual Cost Savings</strong>, take the <strong>Monthly Cost Savings</strong> and multiply it by <strong>12</strong>.</p>
<ul>
<li>Monthly Cost Savings * 12 = Annual Cost Savings</li>
</ul>
<blockquote>
<p>From the estimates above this would be: $3,320 * 12 = $39,840</p>
</blockquote>
<blockquote>
<p>Remember your results may vary, depending on current Azure pricing.</p>
</blockquote></li>
<li><p>Make note that these <strong>Estimated Cost Savings</strong> do not include bandwidth, storage and other charges that will be incurred in hosting the application. The estimates calculated above only pertain to the <strong>App Service Plans</strong> and <strong>SQL Database</strong>.</p>
<blockquote>
From the estimates above this would be:
<ul>
<li>Estimated Monthly Cost Savings: $3,320</li>
<li>Estimated Annual Cost Savings: $39,840</li>
</ul>
</blockquote></li>
</ol>
<h2 id="exercise-2-integrate-traffic-manager">Exercise 2: Integrate Traffic Manager</h2>
<p>Contoso Financial needs new load balancing solutions implemented using Azure Traffic Manager. The existing architecture uses a Load Balancer, but that does not accommodate the growth of Contoso Financial appropriately where they will need to add additional hosting regions in Europe.</p>
<h4 id="help-references-1">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/services/load-balancer/">Azure Load Balancer</a></p>
<p><a href="https://azure.microsoft.com/en-us/services/virtual-network">Azure Traffic Manager</a></p>
<h4 id="task-1-create-traffic-manager">Task 1: Create Traffic Manager</h4>
<ol type="1">
<li><p>From the Azure Management portal <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>+New</strong>, type <strong>Traffic Manager</strong> into the <strong>Search the marketplace</strong> box and press <strong>Enter</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image47.png" title="Azure Portal" alt="In the Azure Portal, New is selected in the left menu. Under New, traffic manager is typed in the search box." /><figcaption>In the Azure Portal, New is selected in the left menu. Under New, traffic manager is typed in the search box.</figcaption>
</figure></li>
<li><p>Click on <strong>Traffic Manager profile</strong> in the list.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image48.png" title="Everything blade" alt="In the Everything blade, under Results, Traffic Manager profile is selected." /><figcaption>In the Everything blade, under Results, Traffic Manager profile is selected.</figcaption>
</figure></li>
<li><p>Click <strong>Create</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image49.png" title="Traffic Manager profile window" alt="In the Traffic Manager profile window, the Create button is circled." /><figcaption>In the Traffic Manager profile window, the Create button is circled.</figcaption>
</figure></li>
<li><p>On the <strong>Create Traffic Manager profile</strong> blade, enter the following values:</p>
<ul>
<li><p>Name: <strong>enter a unique name for the Traffic Manager</strong></p></li>
<li><p>Routing method: <strong>Geographic</strong></p></li>
<li><p>Resource group: <strong>Create New -</strong> <strong>OptimizedTFRG</strong></p></li>
<li><p>Resource group location: <strong>North Central US</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image50.png" title="Create Traffic Manager profile blade" alt="Fields in the Create Traffic Manager profile blade are set to the previously defined settings." /><figcaption>Fields in the Create Traffic Manager profile blade are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
<h4 id="task-2-point-traffic-manager-to-external-internet-load-balancer">Task 2: Point Traffic Manager to External / Internet Load Balancer</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, select the <strong>OptimizedTFRG</strong> resource group, and click on the <strong>Traffic Manager</strong> that was just created.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image51.png" title="Azure Portal" alt="In the left menu of the Azure Portal, the Resource groups icon is selected. In the Resource groups blade, under Subscriptions, Optimized TFRG is selected. In the Optimized TFRG blade, Overview is selected, and under Name, contosowebapp is selected." /><figcaption>In the left menu of the Azure Portal, the Resource groups icon is selected. In the Resource groups blade, under Subscriptions, Optimized TFRG is selected. In the Optimized TFRG blade, Overview is selected, and under Name, contosowebapp is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Traffic Manager</strong> blade, click on <strong>Endpoints</strong> under Settings.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image52.png" title="Endpoints option" alt="Screenshot of the Endpoints option." /><figcaption>Screenshot of the Endpoints option.</figcaption>
</figure></li>
<li><p>On the <strong>Endpoints</strong> blade, click on the <strong>Add</strong> button.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image53.png" title="contosowebapp- Endpoints blade" alt="In the contosowebapp- Endpoints blade, the Add button is selected." /><figcaption>In the contosowebapp- Endpoints blade, the Add button is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Add endpoint</strong> blade, enter the following values:</p>
<ul>
<li><p>Type: <strong>Azure endpoint</strong></p></li>
<li><p>Name: <strong>External Load Balancer</strong></p></li>
<li><p>Target resource type: <strong>Public IP address</strong></p>
<p><img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image54.png" title="Add endpoint blade" alt="On the Add endpoint blade, fields are set to the previously defined settings." />**<br />
</p></li>
</ul></li>
<li><p>Click on <strong>Choose a public IP address</strong>, and select the <strong>WebAPPLBIP</strong> IP Address in the <strong>ContosoExistingRG</strong> resource group.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image55.png" title="Add endpoint and Resource blades" alt="In the Add endpoint blade, Target resource, which is selected to WebAPPLBIP, is selected. In the Resource blade, WebAPPLBIP (ContosoExistingRG) is selected." /><figcaption>In the Add endpoint blade, Target resource, which is selected to WebAPPLBIP, is selected. In the Resource blade, WebAPPLBIP (ContosoExistingRG) is selected.</figcaption>
</figure></li>
<li><p>Set <strong>Regional grouping</strong> to <strong>All (World)</strong> so this endpoint will load balanced against all traffic going to Traffic Manager for now.<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image56.png" title="Add endpoint blade" alt="In the Add endpoint blade, the Regional grouping field is set to All (World). The remaining fields are set to the following settings: Type, Azure endpoint; Name, External Load Balancer; Target resource type, Public IP address; Target resource, WebAPPLBIP." /></p></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click on <strong>Overview</strong>, and select the <strong>DNS Name</strong> for the Traffic Manager to navigate to the sample application in a new browser window</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image57.png" title="contosowebapp blade" alt="In the left pane of the contosowebapp blade, Overview is selected. In the right pane, under Essentials, DNS name contosowebapp.trafficmanager.net is selected." /><figcaption>In the left pane of the contosowebapp blade, Overview is selected. In the right pane, under Essentials, DNS name contosowebapp.trafficmanager.net is selected.</figcaption>
</figure></li>
<li><p>The sample application loading will indicate the <strong>Traffic Manager</strong> was configured correctly.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image58.png" title="Contoso Financial login webpage" alt="The Contoso Financial login webpage displays." /><figcaption>The Contoso Financial login webpage displays.</figcaption>
</figure></li>
</ol>
<h2 id="exercise-3-setup-api-tier-in-azure-app-service">Exercise 3: Setup API Tier in Azure App Service</h2>
<p>In the migration of IaaS to PaaS, the API Tier of Contoso Financials application needs to be migrated to run in an Azure App Service Web App without requiring any code changes to the application.</p>
<h4 id="help-references-2">Help references</h4>
<p><a href="https://docs.microsoft.com/en-us/azure/app-service-api/app-service-api-apps-why-best-platform">API Apps overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-dotnet-get-started/">Deploy an ASP.NET web app to Azure App Service, using Visual Studio</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="step-1-create-app-service-for-web-api-tier">Step 1: Create App Service for Web API Tier</h4>
<ol type="1">
<li><p>From the Azure Management portal <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>+New</strong>, and type <strong>API App</strong> into the search box, and press <strong>Enter</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image59.png" title="Azure Portal" alt="In the left menu of the Azure Portal, New is selected. In the New pane, the search field is set to API App." /><figcaption>In the left menu of the Azure Portal, New is selected. In the New pane, the search field is set to API App.</figcaption>
</figure></li>
<li><p>Click on <strong>API App</strong> in the search results, and click <strong>Create</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image60.png" title="Search Results" alt="In the Search Results, API app is selected." /><figcaption>In the Search Results, API app is selected.</figcaption>
</figure></li>
<li><p>On the <strong>API App</strong> blade, enter the following values:</p>
<ul>
<li><p>App name: <strong>enter a unique name</strong></p></li>
<li><p>Resource group: <strong>Create New -</strong> <strong>OptimizedAPIRG</strong></p></li>
<li><p>App Insights: <strong>Off</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image61.png" title="API App blade" alt="Fields in the API App blade are set to the previously defined settings." /><figcaption>Fields in the API App blade are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click on <strong>App Service plan/Location</strong>, followed by <strong>Create New</strong>, and fill in the following values:</p>
<ul>
<li><p>App Service plan: <strong>OptimizedAPIPlan</strong></p></li>
<li><p>Location: <strong>North Central US</strong></p></li>
<li><p>Pricing tier: **S1 Standard<br />
</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image62.png" title="API App, App Service plan, and New App Service Plan blades" alt="In the API App blade,App Service plan/Location is selected. , In the App Service plan blade, Create New is selected. In the New App Service Plan blade, fields are set to the previously defined settings." /><figcaption>In the API App blade,App Service plan/Location is selected. , In the App Service plan blade, Create New is selected. In the New App Service Plan blade, fields are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
<h4 id="step-2-setup-app-settings">Step 2: Setup App Settings</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, select the <strong>ContosoExistingRG</strong> resource group, and click on the <strong>contosofinancialdb</strong> SQL Database.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image63.png" title="Azure Portal" alt="In the Azure Portal, in the left menu, Resource groups is selected. In the Resource groups blade, under Subscriptions, ContosoExistingRG is selected. In the ContosoExistingRG blade, Overview is selected, and under Essentials, the SQL database contosofinancialdb is selected." /><figcaption>In the Azure Portal, in the left menu, Resource groups is selected. In the Resource groups blade, under Subscriptions, ContosoExistingRG is selected. In the ContosoExistingRG blade, Overview is selected, and under Essentials, the SQL database contosofinancialdb is selected.</figcaption>
</figure></li>
<li><p>On the <strong>SQL database</strong> blade, click on <strong>Show database connection strings</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image64.png" title="SQL database blade" alt="In the left pane of the SQL database blade, Overview is selected. In the right pane, under Essentials, the Connection strings link Show database connection strings is selected." /><figcaption>In the left pane of the SQL database blade, Overview is selected. In the right pane, under Essentials, the Connection strings link Show database connection strings is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Database connection strings</strong> blade, copy the <strong>ADO.NET (SQL authentication)</strong> connection string to use later.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image65.png" title="Database connection strings blade" alt="In the Database connection strings blade, the ADO.NET (SQL authentication) connection string is selected." /><figcaption>In the Database connection strings blade, the ADO.NET (SQL authentication) connection string is selected.</figcaption>
</figure></li>
<li><p>Click on <strong>Resource groups</strong>, click on the <strong>OptimizedAPIRG</strong> resource group, and then, click on the previously created <strong>API App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image66.png" title="Azure Portal" alt="In the Azure Portal left menu, Resource groups is selected. In the Resource groups blade, under Subscriptions, OptimizedAPIRG is selected. In the OptimizedAPIRG blade, Overview is selected, and in the Essentials section, the contosofinancialapi App Service is selected." /><figcaption>In the Azure Portal left menu, Resource groups is selected. In the Resource groups blade, under Subscriptions, OptimizedAPIRG is selected. In the OptimizedAPIRG blade, Overview is selected, and in the Essentials section, the contosofinancialapi App Service is selected.</figcaption>
</figure></li>
<li><p>On the <strong>App Service</strong> blade, click on <strong>Application settings</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image67.png" title="App Service blade" alt="In the App Service blade, under Settings, Application settings is selected." /><figcaption>In the App Service blade, under Settings, Application settings is selected.</figcaption>
</figure></li>
<li><p>Scroll down to the <strong>Connection strings</strong> section, and add a <strong>new</strong> connection string with the following values:</p>
<ul>
<li><p>Name: <strong>TransactionDb</strong></p></li>
<li><p>Value: <strong>paste in the database connection string that was copied earlier</strong></p></li>
<li><p>Type: <strong>SQL Database</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image68.png" title="Application settings blade" alt="In the Application settings blade, fields in the Connection strings are set to the previously defined settings." /><figcaption>In the Application settings blade, fields in the Connection strings are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Replace the value <strong>{your_username}</strong> with <strong>demouser</strong> in the connection string.</p></li>
<li><p>Replace the value <strong>{your_password}</strong> with <strong>demo@pass123</strong> in the connection string.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
<h4 id="step-3-deploy-api-to-app-service">Step 3: Deploy API to App Service</h4>
<ol type="1">
<li><p>From the <em>C:\HOL\Contoso.Financial</em> folder, open the Visual Studio Solution: <strong>Contoso.Financial.sln</strong>.</p></li>
<li><p>In the <strong>Solution Explorer</strong> window, expand the <strong>API</strong> folder, right-click the <strong>Contoso.Financial.Api</strong>, and click on <strong>Publish…</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image69.png" title="Solution Explorer" alt="In Solution Explorer, under API, Contoso.Financial.Api is selected, and from it&#39;s right-click menu, Publish is selected." /><figcaption>In Solution Explorer, under API, Contoso.Financial.Api is selected, and from it's right-click menu, Publish is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Publish</strong> window, click on <strong>Microsoft Azure App Service</strong>, check the <strong>Select Existing</strong> option, and click <strong>Publish</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image70.png" title="Publish window" alt="In the Publish window, Microsoft Azure App Service, Select Existing, and Publish are selected." /><figcaption>In the Publish window, Microsoft Azure App Service, Select Existing, and Publish are selected.</figcaption>
</figure></li>
<li><p>In the top-right corner of the <strong>App Service</strong> dialog, make sure your account is selected. If it is not, click on the button, and add it.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image71.png" title="Microsoft account button" alt="Screenshot of the Microsoft account button." /><figcaption>Screenshot of the Microsoft account button.</figcaption>
</figure></li>
<li><p>Expand the <strong>OptimizedAPIRG</strong> resource group, select the <strong>App Service Web App</strong>, and click <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image72.png" title="App Service window" alt="In the App Service window, the OptimizedAPIRG folder is expanded, and Contosofinancial.api is selected." /><figcaption>In the App Service window, the OptimizedAPIRG folder is expanded, and Contosofinancial.api is selected.</figcaption>
</figure></li>
<li><p>Once the deployment has completed, Visual Studio will automatically open a new browser window navigating to the <strong>App Service</strong> app. This window can be closed.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image74.png" title="Transaction API webpage" alt="The Transaction API webpage displays." /><figcaption>The Transaction API webpage displays.</figcaption>
</figure></li>
</ol>
<h2 id="exercise-4-migrate-web-app-tier-to-app-service">Exercise 4: Migrate Web App Tier to App Service</h2>
<p>In the migration of IaaS to PaaS, the Front-end Web App Tier of Contoso Financials application needs to be migrated to run in an Azure App Service Web App without requiring any code changes to the application.</p>
<h4 id="help-references-3">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-web-overview/">Azure Web Apps overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-dotnet-get-started/">Deploy an ASP.NET web app to Azure App Service, using Visual Studio</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="step-1-create-app-service-for-web-app-tier">Step 1: Create App Service for Web App Tier</h4>
<ol type="1">
<li><p>From the Azure Management portal <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>+New</strong>, then <strong>Web + Mobile</strong>, and then click on <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image75.png" title="Azure Portal" alt="In the Azure Portal left menu, New is selected. In the New pane, under Azure Marketplace, Web + Mobile is selected. Under Featured, the Web App Quickstart tutorial link is selected." /><figcaption>In the Azure Portal left menu, New is selected. In the New pane, under Azure Marketplace, Web + Mobile is selected. Under Featured, the Web App Quickstart tutorial link is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Web App</strong> blade, enter the following values:</p>
<ul>
<li><p>App name: <strong>enter a unique name</strong></p></li>
<li><p>Resource Group: <strong>Create New - OptimizedWebAppRG</strong></p></li>
<li><p>App Insights: <strong>Off</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image76.png" title="Web App blade" alt="Fields in the Web App blade are set to the previously defined settings." /><figcaption>Fields in the Web App blade are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Click on <strong>App Service plan/Location</strong>, then <strong>Create New</strong>, and fill in the following values:</p>
<ul>
<li><p>App Service plan: <strong>OptimizedWebAppPlan</strong></p></li>
<li><p>Location: <strong>North Central US</strong></p></li>
<li><p>Pricing tier: <strong>S1 Standard</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image77.png" title="Web App, and App Service plan blades" alt="In the Web App blade, App Service plan/Location is selected. In the App Service plan blade, Create New is selected, and fields are set to the previously defined settings." /><figcaption>In the Web App blade, App Service plan/Location is selected. In the App Service plan blade, Create New is selected, and fields are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
<h4 id="step-2-setup-app-settings-1">Step 2: Setup App Settings</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, click on the <strong>OptimizedWebAppRG</strong> resource group, then click on the <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image78.png" title="Azure Portal" alt="In the Azure Portal left menu, Resource groups is selected. In the Resource groups blade, OptimizedWebAppRG is selected. In the OptimizedWebAppRG blade, Overview is selected, and under Essentials, the contosofinancialwebapp app service is selected." /><figcaption>In the Azure Portal left menu, Resource groups is selected. In the Resource groups blade, OptimizedWebAppRG is selected. In the OptimizedWebAppRG blade, Overview is selected, and under Essentials, the contosofinancialwebapp app service is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Web App</strong> blade, click on <strong>Application settings</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image79.png" title="App Service blade" alt="In the App Service blade, under Settings, Application settings is selected." /><figcaption>In the App Service blade, under Settings, Application settings is selected.</figcaption>
</figure></li>
<li><p>Scroll down to the <strong>App settings</strong> section, and create a <strong>new</strong> app setting with the following values:</p>
<ul>
<li>Key: <strong>transactionAPIUrl</strong></li>
</ul></li>
<li><p>Value: <strong>paste in the URL of the App Service API App that is hosting the API Tier</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image80.png" title="App Service blade" alt="In the App Service blade, under App settings are set to transactionAPIUrl, and http://contosofinancialapi..." /><figcaption>In the App Service blade, under App settings are set to transactionAPIUrl, and http://contosofinancialapi...</figcaption>
</figure></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
<h4 id="step-3-deploy-app-to-web-app">Step 3: Deploy App to Web App</h4>
<ol type="1">
<li><p>From the <em>C:\HOL\Contoso.Financial</em> folder, open the Visual Studio Solution: <strong>Contoso.Financial.sln</strong>.</p></li>
<li><p>In the <strong>Solution Explorer</strong> window, expand the <strong>Web</strong> folder, right-click the <strong>Contoso.Financial.Website</strong> project, and click on <strong>Publish…</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image81.png" title="Solution Explorer" alt="In Solution Explorer, Web is expanded, Contoso.Financial.Website is selected, and Publish is selected from its right-click menu." /><figcaption>In Solution Explorer, Web is expanded, Contoso.Financial.Website is selected, and Publish is selected from its right-click menu.</figcaption>
</figure></li>
<li><p>On the <strong>Publish</strong> window, click on <strong>Microsoft Azure App Service</strong>, check the <strong>Select Existing</strong> option, and click <strong>Publish</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image70.png" title="Publish window" alt="In the Publish window, Microsoft Azure App Service, Select Existing, and Publish are all selected." /><figcaption>In the Publish window, Microsoft Azure App Service, Select Existing, and Publish are all selected.</figcaption>
</figure></li>
<li><p>In the top-right corner of the <strong>App Service</strong> dialog, make sure your account is selected. If it is not, click on the button, and add it.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image71.png" title="Microsoft account button" alt="Screenshot of the Microsoft account button." /><figcaption>Screenshot of the Microsoft account button.</figcaption>
</figure></li>
<li><p>Expand the <strong>OptimizedWebAppRG</strong> resource group, select the <strong>Web App</strong>, and click <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image82.png" title="App Service window" alt="In the App Service window, OptimizedWebAppRG is expanded, and contosofinancialwebapp is selected." /><figcaption>In the App Service window, OptimizedWebAppRG is expanded, and contosofinancialwebapp is selected.</figcaption>
</figure></li>
<li><p>Once the deployment has completed, Visual Studio will automatically open a new browser window navigating to the <strong>Web App</strong>.</p></li>
</ol>
<h4 id="step-4-add-web-app-to-traffic-manager">Step 4: Add Web App to Traffic Manager</h4>
<ol type="1">
<li><p>From the Azure Management portal <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>Resource groups</strong> followed by the <strong>OptimizedTFRG</strong> resource group, and then, click on the <strong>Traffic Manager</strong>.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image83.png" title="Azure Portal" alt="In the left menu of the Azure Portal, Resource groups is selected. In the Resource groups blade, under Subscriptions, OptimizedTFRG is selected. In the OptimizedTFRG blade, Overview is selected, and under Essentials, the contosowebapp Traffic Manager is selected." /></p></li>
<li><p>On the <strong>Traffic Manager profile</strong> blade, click on <strong>Endpoints</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image84.png" title="Endpoints option" alt="Screenshot of the Endpoints option." /><figcaption>Screenshot of the Endpoints option.</figcaption>
</figure></li>
<li><p>Click <strong>Add</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image85.png" title="contosowebapp - Endpoints blade" alt="In the contosowebapp - Endpoints blade, the Add button is selected." /><figcaption>In the contosowebapp - Endpoints blade, the Add button is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Add endpoint</strong> blade, enter the following values:</p>
<ul>
<li><p>Type: <strong>Azure endpoint</strong></p></li>
<li><p>Name: <strong>Web App</strong></p></li>
<li><p>Target resource type: <strong>App Service</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image86.png" title="Add endpoint blade" alt="Fields in the Add endpoint blade are set to the previously defined settings." /><figcaption>Fields in the Add endpoint blade are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Click on <strong>Choose an app service</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image87.png" title="Choose an app service option" alt="Screenshot of the Choose an app service option." /><figcaption>Screenshot of the Choose an app service option.</figcaption>
</figure></li>
<li><p>Click on the previously created <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image88.png" title="Resource blade" alt="In the Resource blade, contosofinancialwebapp is selected." /><figcaption>In the Resource blade, contosofinancialwebapp is selected.</figcaption>
</figure></li>
<li><p>Set <strong>Regional grouping</strong> to <strong>North America / Central America / Caribbean</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image89.png" title="contosofinancialwebapp section" alt="Under contosofinancialwebapp, Regional grouping is set to North America / Central America / Caribbean." /><figcaption>Under contosofinancialwebapp, Regional grouping is set to North America / Central America / Caribbean.</figcaption>
</figure>
<blockquote>
<p>If you are geographically located outside of the “North America / Central America / Caribbean” region specified, then choose the next closest region to where you are located. It is important that you choose a “Regional grouping” here that matches where you are located so you can run and test the rest of this HOL.</p>
</blockquote></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click on the <strong>External Load Balancer</strong> Endpoint.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image90.png" title="External Load Balancer option" alt="Under Name, External Load Balancer is selected." /><figcaption>Under Name, External Load Balancer is selected.</figcaption>
</figure></li>
<li><p>Select the <strong>Disabled Status</strong>, and click <strong>Save</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image91.png" title="External Load Balancer blade" alt="In the External Load Balancer blade, Status is set to Disabled, and Save is selected." /><figcaption>In the External Load Balancer blade, Status is set to Disabled, and Save is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Traffic Manager</strong>, click on <strong>Overview</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image92.png" title="contosowebapp blade" alt="In the contosowebapp blade, Overview is selected." /><figcaption>In the contosowebapp blade, Overview is selected.</figcaption>
</figure></li>
<li><p>Click on the <strong>DNS name</strong> to open it in a new browser window.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image93.png" title="contosowebapp blade" alt="In the contosowebapp blade, under Essentials, the DNS name contosowebapp.trafficmanager.net link is selected." /><figcaption>In the contosowebapp blade, under Essentials, the DNS name contosowebapp.trafficmanager.net link is selected.</figcaption>
</figure></li>
<li><p>Verify the site still loads as expected.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image94.png" title="Contoso Financial login webpage" alt="The Contoso Financial login webpage displays." /><figcaption>The Contoso Financial login webpage displays.</figcaption>
</figure></li>
<li><p>Click on <strong>Endpoints</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image95.png" title="Settings section" alt="Under Settings, Endpoints is selected." /><figcaption>Under Settings, Endpoints is selected.</figcaption>
</figure></li>
<li><p>Click on the <strong>External Load Balancer</strong> endpoint.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image90.png" title="External Load Balancer option" alt="Under Name, the External Load Balancer option is selected." /><figcaption>Under Name, the External Load Balancer option is selected.</figcaption>
</figure></li>
<li><p>Click <strong>Delete</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image96.png" title="External Load Balancer blade" alt="The Delete button is selected in the External Load Balancer blade." /><figcaption>The Delete button is selected in the External Load Balancer blade.</figcaption>
</figure></li>
<li><p>On the <strong>Delete Traffic Manager endpoint</strong> prompt, click <strong>Yes</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image97.png" title="External Load Balancer blade" alt="In the External Load Balancer blade, a message displays confirming that you want to delete the traffic manager endpoint, and the Yes button is selected." /><figcaption>In the External Load Balancer blade, a message displays confirming that you want to delete the traffic manager endpoint, and the Yes button is selected.</figcaption>
</figure>
<blockquote>
<p>Following this step, the Web App Tier’s Load Balancer and VMs will no longer receive requests through the Traffic Manager.</p>
</blockquote></li>
</ol>
<h4 id="step-5-take-down-web-app-and-api-vms">Step 5: Take down Web App and API VMs</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, and then click on the <strong>ContosoExistingRG</strong> resource group.</p></li>
<li><p>Click on the <strong>WebApp1</strong> virtual machine.</p></li>
<li><p>Click the <strong>Stop</strong> button.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image98.png" title="WebAPI1 blade" alt="In the left pane of the WebAPI1 blade, Overview is selected. In the right pane, on the top menu, the Stop button is selected." /><figcaption>In the left pane of the WebAPI1 blade, Overview is selected. In the right pane, on the top menu, the Stop button is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Stop this virtual machine</strong> prompt, click <strong>Yes</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image99.png" title="Stop this virtual machine prompt" alt="In the Stop this virtual machine prompt, a confirmation message displays asking if you want to stop WebAPI1, and the Yes button is selected." /><figcaption>In the Stop this virtual machine prompt, a confirmation message displays asking if you want to stop WebAPI1, and the Yes button is selected.</figcaption>
</figure></li>
<li><p>Repeat the last three steps for the <strong>WebApp2, WebAPI1,</strong> and <strong>WebAPI2</strong> virtual machines.</p></li>
<li><p>Open a new browser window / tab, and navigate to the URL for the <strong>Traffic Manager endpoint</strong>.</p></li>
<li><p><strong>Login</strong> to the Web App, and ensure it loads all data as expected to test out the <strong>App Service</strong> hosted Web App and API tiers are functioning properly. FYI, the password can be anything, just type something in the password and click Sign in to login to the sample app.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image100.png" title="Account Overview webpage" alt="The Account Overview webpage displays with an available balance and a list of account transactions." /></p></li>
<li><p>After validating the app, close the browser window.</p></li>
</ol>
<h2 id="exercise-5-migrate-background-tier-to-app-service">Exercise 5: Migrate Background Tier to App Service</h2>
<p>In the migration of IaaS to PaaS, the Background Tier (written as a console app) of Contoso Financials application needs to be migrated to run in an Azure App Service Web Job without requiring any code changes to the application.</p>
<h4 id="help-references-4">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-webjobs-readme/%3E">Using WebJobs in Azure App Service</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-create-web-jobs/">Run Background tasks with WebJobs</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="step-1-create-app-service-for-background-tier">Step 1: Create App Service for Background Tier</h4>
<ol type="1">
<li><p>From the Azure Management portal <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>+New</strong> followed by <strong>Web + Mobile</strong>, and then, click on <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image75.png" title="Azure Portal" alt="New is selected in the left menu of the Azure Portal. In the New pane, under Azure Marketplace, Web + Mobile is selected, and under Featured, the Web App Quickstart tutorial link is selected." /><figcaption>New is selected in the left menu of the Azure Portal. In the New pane, under Azure Marketplace, Web + Mobile is selected, and under Featured, the Web App Quickstart tutorial link is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Web App</strong> blade, enter the following values:</p>
<ul>
<li><p>App name: <strong>enter a unique name</strong></p></li>
<li><p>Resource Group: <strong>OptimizedBackgroundRG</strong></p></li>
<li><p>App Insights: <strong>Off</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image101.png" title="Web App blade" alt="The Web App blade fields are set to the previously defined settings." /><figcaption>The Web App blade fields are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click on <strong>App Service plan/Location</strong>, select <strong>Create New</strong>, and fill in the following values:</p>
<ul>
<li><p>App Service plan: <strong>OptimizedBackgroundPlan</strong></p></li>
<li><p>Location: <strong>North Central US</strong></p></li>
<li>Pricing tier: <strong>S1 Standard</strong></li>
<li><figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image102.png" title="Web App and App Service plan blades" alt="In the Web App blade, App Service plan OptimizedBackgroundPlan is selected. In the App Service plan blade, Create New is selected, and fields are set to the previously defined settings." /><figcaption>In the Web App blade, App Service plan OptimizedBackgroundPlan is selected. In the App Service plan blade, Create New is selected, and fields are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
<h4 id="step-2-setup-app-settings-2">Step 2: Setup App Settings</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, select the <strong>OptimizedBackgroundRG</strong> resource group, and select the <strong>App Service</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image103.png" title="Azure Portal" alt="In the left menu of the Azure Portal, Resource groups is selected. In the Resource groups blade, OptimizedBackgroundRG is selected. In the OptimizedBackgroundRG blade, Overview is selected, and in the Essentials section, the contosofinancialbackground App Service is selected." /><figcaption>In the left menu of the Azure Portal, Resource groups is selected. In the Resource groups blade, OptimizedBackgroundRG is selected. In the OptimizedBackgroundRG blade, Overview is selected, and in the Essentials section, the contosofinancialbackground App Service is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Web app</strong> blade, click on <strong>Application settings</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image104.png" title="contosofinancialbackground blade" alt="In the contosofinancialbackground blade, under Settings, Application settings is selected." /><figcaption>In the contosofinancialbackground blade, under Settings, Application settings is selected.</figcaption>
</figure></li>
<li><p>Scroll down to the <strong>Connection strings</strong> section, and add a <strong>new</strong> connection string with the following values:</p>
<ul>
<li><p>Name: <strong>TransactionDb</strong></p></li>
<li><p>Value: <strong>past in the database connection string that was copied earlier</strong></p></li>
<li><p>Type: <strong>SQL Database</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image105.png" title="contosofinancialbackground - Application settings blade" alt="In the contosofinancialbackground - Application settings blade, Connection strings values are set to the previously defined settings." /><figcaption>In the contosofinancialbackground - Application settings blade, Connection strings values are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Replace the value <strong>{your_username}</strong> with <strong>demouser</strong> in the connection string.</p></li>
<li><p>Replace the value <strong>{your_password}</strong> with <strong>demo@pass123</strong> in the connection string.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
<h4 id="step-3-deploy-app-to-app-service">Step 3: Deploy App to App Service</h4>
<ol type="1">
<li><p>From the <em>C:\HOL\Contoso.Financial</em> folder, open the Visual Studio Solution: <strong>Contoso.Financial.sln</strong></p></li>
<li><p>In the <strong>Solution Explorer</strong> window, expand the <strong>Background</strong> folder, and right-click the <strong>Contoso.Financial.Background</strong> project followed by clicking on <strong>Publish as Azure WebJob…</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image106.png" title="Solution Explorer" alt="In Solution Explorer, the Background folder is expanded, and Contoso.Financial.Background is selected. From its right-click menu, Publish as Azure WebJob is selected." /><figcaption>In Solution Explorer, the Background folder is expanded, and Contoso.Financial.Background is selected. From its right-click menu, Publish as Azure WebJob is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Add Azure WebJob</strong> dialog, enter the following values:</p>
<ul>
<li><p>WebJob name: <strong>Background1</strong></p></li>
<li><p>WebJob run mode: <strong>Run on Demand</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image107.png" title="Add Azure WebJob window" alt="In the Add Azure WebJob window, fields are set to the previously defined settings." /><figcaption>In the Add Azure WebJob window, fields are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>On the <strong>Publish</strong> dialog, click on <strong>Microsoft Azure App Service</strong>. .<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image108.png" title="Publish window" alt="In the Publish window, under Select a publish target, Microsoft Azure App Service is selected." /></p></li>
<li><p>In the top-right corner of the <strong>App Service</strong> dialog, make sure your account is selected. If it is not, click on the button, and add it.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image71.png" title="Microsoft account button" alt="Screenshot of the Microsoft account button." /><figcaption>Screenshot of the Microsoft account button.</figcaption>
</figure></li>
<li><p>Expand the <strong>OptimizedBackgroundRG</strong> resource group, and select the <strong>App Service Web App</strong>, followed by clicking <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image109.png" title="App Service window" alt="In the App Service window, the OptimizedBackgroundRG folder is expanded, and contosofinancialbackground is selected." /><figcaption>In the App Service window, the OptimizedBackgroundRG folder is expanded, and contosofinancialbackground is selected.</figcaption>
</figure></li>
<li><p>Click <strong>Publish</strong>.</p>
<p>[In the Publish window, the Publish button is selected.]&gt;(images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image110.png “Publish window”)</p>
<blockquote>
<p>If the WebJob deployment fails due to a code signing error message, simply open up the <strong>Project Properties</strong> for the Contoso.Financial.Background project by right-clicking it in <strong>Solution Explorer</strong>. Then, go to the <strong>Signing</strong> tab, and <strong>uncheck</strong> the <strong>Sign the ClickOnce manifests</strong> checkbox. Upon completion, Publish the WebJob project again.</p>
</blockquote>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image111.png" title="Solution Explorer" alt="In Solution Explorer, Background and Contoso.Financial.Background are expanded, and Properties is selected. In the ContosoFinancialBackground Properties pane, Signing is selected, and the checkbox is cleared for Sign the ClickOnce manifests." /><figcaption>In Solution Explorer, Background and Contoso.Financial.Background are expanded, and Properties is selected. In the ContosoFinancialBackground Properties pane, Signing is selected, and the checkbox is cleared for Sign the ClickOnce manifests.</figcaption>
</figure></li>
<li><p>Navigate to the <strong>contosofinancialbackground</strong> Web App in the Azure Portal, click on the <strong>WebJobs</strong> pane. Then, click on the <strong>Background1</strong> WebJob, and select <strong>Properties</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image112.png" title="contosofinancialbackground - WebJobs blade" alt="In the contosofinancialbackground - WebJobs blade, in the left pane, WebJobs is selected. In the right pane, under WebJobs, Background1 is selected." /><figcaption>In the contosofinancialbackground - WebJobs blade, in the left pane, WebJobs is selected. In the right pane, under WebJobs, Background1 is selected.</figcaption>
</figure></li>
<li><p>Copy the <strong>Web Hook URL, User Name, and Password</strong>. Save these properties for setting up the Scheduler next.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image113.png" title="Properties blade" alt="In the Properties blade, the following fields are defined: Name, Background1; Status, Ready; Type, triggered; Web Hook, https://contosofinancialbackground.sc...; User Name, $contosofinancialbackground; Password (hidden)." /><figcaption>In the Properties blade, the following fields are defined: Name, Background1; Status, Ready; Type, triggered; Web Hook, https://contosofinancialbackground.sc...; User Name, $contosofinancialbackground; Password (hidden).</figcaption>
</figure></li>
<li><p>From the Azure Portal, click on <strong>+New</strong>, and type “<strong>scheduler</strong>” into the search box. Press <strong>Enter</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image114.png" title="Azure Portal" alt="In the left menu of the Azure Portal, the New button is selected. In the New blade, scheduler is typed in the search field." /><figcaption>In the left menu of the Azure Portal, the New button is selected. In the New blade, scheduler is typed in the search field.</figcaption>
</figure></li>
<li><p>Select <strong>Scheduler</strong> from the search results, and click <strong>Create</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image115.png" title="Results section" alt="In the Results section, Scheduler is selected." /><figcaption>In the Results section, Scheduler is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Scheduler Job</strong> blade, enter the following values:</p>
<ul>
<li>Name: <strong>Background-Scheduler</strong><br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image116.png" title="Scheduler Job blade" alt="In the Scheduler Job blade, under Create, the Name field is set to Background-Scheduler." /></li>
</ul></li>
<li><p>Click on <strong>Job Collection</strong>, click on <strong>Create new</strong>, enter the following values, and click <strong>OK</strong>.</p>
<ul>
<li><p>Name: <strong>Background-Scheduler-Job</strong></p></li>
<li><p>Resource Group: <strong>select the existing OptimizedBackgroundRG</strong>.<strong><br />
</strong><img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image117.png" title="New job collection blade" alt="In the New job collection blade, Name is set to Background-Scheduler-Job, Pricing tier is S Standard, Resource group is Use existing OptimizedBackgroundRG, and Location is South Central US." /></p></li>
</ul></li>
<li><p>Click on <strong>Configure Action settings</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image118.png" title="Configure Action Settings option" alt="Screenshot of the Configure Action Settings option." /><figcaption>Screenshot of the Configure Action Settings option.</figcaption>
</figure></li>
<li><p>On the <strong>Action settings</strong> pane, enter the <strong>Web Hook URL</strong> copied earlier to the <strong>URL</strong> field, set the <strong>Action</strong> to <strong>Https</strong>, and set the <strong>Method</strong> equal to <strong>Post</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image119.png" title="Action settings blade" alt="In the Action settings blade, Action is set to Https, Method is set to Post, and the URL is the previously copied Web Hook URL." /><figcaption>In the Action settings blade, Action is set to Https, Method is set to Post, and the URL is the previously copied Web Hook URL.</figcaption>
</figure></li>
<li><p>Click on <strong>Authentication settings</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image120.png" title="Authentication settings option" alt="Under Optional settings, Authentication settings is selected." /><figcaption>Under Optional settings, Authentication settings is selected.</figcaption>
</figure></li>
<li><p>Enter the following values, and click <strong>OK</strong>.</p>
<ul>
<li><p>Authenication type: <strong>Basic</strong></p></li>
<li><p>Username: <strong>Webhook username copied earlier</strong></p></li>
<li><p>Password: <strong>Webhook password copied earlier</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image121.png" title="Authentication blade" alt="Fields in the Authentication blade are set to the previously defined settings." /><figcaption>Fields in the Authentication blade are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>OK</strong> then click <strong>OK</strong> again.</p></li>
<li><p>Click on <strong>Configure Schedule</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image122.png" title="Configure Schedule option" alt="Screenshot of the Configure Schedule option." /><figcaption>Screenshot of the Configure Schedule option.</figcaption>
</figure></li>
<li><p>Select <strong>Recurring</strong>, and specify Recur every <strong>1 minute</strong> followed by clicking <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image123.png" title="Schedule blade" alt="In the Schedule blade, fields are set to the previously defined settings." /><figcaption>In the Schedule blade, fields are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Click <strong>Ok</strong> and then click <strong>Create</strong>.</p></li>
<li><p>Wait a couple minutes, and then, look at the <strong>History</strong> tile of the <strong>Scheduler Job</strong> blade to verify the scheduled job is running. The <strong>bar graph</strong> and <strong>successes count</strong> will reflect that it is running.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image124.png" title="Monitoring section" alt="In the Monitoring section, a History bar graph displays, with 6 successes, 0 required retries, and 0 failures." /><figcaption>In the Monitoring section, a History bar graph displays, with 6 successes, 0 required retries, and 0 failures.</figcaption>
</figure></li>
<li><p>Open a new browser window or tab navigating to the <strong>URL</strong> for the <strong>Traffic Manager</strong> for the application, and verify the transactions generated by the background process are showing up.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image125.png" title="Account Overview webpage" alt="The Account Overview webpage displays with an available balance and a list of account transactions." /><figcaption>The Account Overview webpage displays with an available balance and a list of account transactions.</figcaption>
</figure></li>
</ol>
<h4 id="step-4-take-down-background-tier-vm">Step 4: Take down Background Tier VM</h4>
<ol type="1">
<li><p>From the Azure Management Portal (<a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>), click on <strong>Resource groups</strong>, and then, click on the <strong>ContosoExistingRG</strong> resource group.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image126.png" title="Azure Portal" alt="In the left pane of the Azure Portal, Resource groups is selected. In the Resource groups pane, under Subscriptions, ContosoExistingRG is selected." /><figcaption>In the left pane of the Azure Portal, Resource groups is selected. In the Resource groups pane, under Subscriptions, ContosoExistingRG is selected.</figcaption>
</figure></li>
<li><p>Click on the <strong>Background1</strong> virtual machine.</p></li>
<li><p>Click the <strong>Stop</strong> button.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image127.png" title="Background1 blade" alt="In the left pane of the Background1 blade, Overview is selected. In the right pane, the Stop button is selected." /><figcaption>In the left pane of the Background1 blade, Overview is selected. In the right pane, the Stop button is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Stop this virtual machine</strong> prompt, click <strong>Yes</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image128.png" title="Stop this virtual machine prompt" alt="In the Stop this virtual machine prompt, a confirmation message displays asking if you want to stop Background1, and the Yes button is selected." /><figcaption>In the Stop this virtual machine prompt, a confirmation message displays asking if you want to stop Background1, and the Yes button is selected.</figcaption>
</figure></li>
</ol>
<h2 id="exercise-6-setup-sql-database-geo-replication">Exercise 6: Setup SQL Database Geo-Replication</h2>
<p>Due to the rush into Production, the Staging SQL Database currently remains as the Production database for the application. You have been asked to implement Geo-Replication to the SQL Database in order to add the appropriate redundancy to safeguard against failures. This will both help eliminate data loss in case of a data center failure as well as greatly reduce the potential system downtime in the event of such a failure.</p>
<h4 id="help-references-5">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/sql-database-technical-overview/">Introduction to SQL Database</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/sql-database-geo-replication-overview/">SQL Database Active Geo-Replication</a></p>
<h4 id="step-1-setup-sql-database-geo-replication">Step 1: Setup SQL Database Geo-Replication</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, click on the <strong>ContosoExistingRG</strong> resource group followed by clicking on the <strong>contosofinancialdb</strong> SQL Database.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image129.png" title="Azure Portal" alt="In the Azure Portal left menu, Resource groups is selected. In the Resource groups pane, under Subscriptions, ContosoExistingRG is selected. In the ContosoExistingRG blade, both Overview and the contosofinancialdb SQL database are selected" /><figcaption>In the Azure Portal left menu, Resource groups is selected. In the Resource groups pane, under Subscriptions, ContosoExistingRG is selected. In the ContosoExistingRG blade, both Overview and the contosofinancialdb SQL database are selected</figcaption>
</figure></li>
<li><p>On the <strong>SQL database</strong> blade, click on <strong>Geo-Replication</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image130.png" title="Contosofinancialdb blade" alt="In the Contosofinancialdb blade, under Settings, Geo-Replication is selected." /><figcaption>In the Contosofinancialdb blade, under Settings, Geo-Replication is selected.</figcaption>
</figure></li>
<li><p>Click on the <strong>Recommended Target Region</strong> to replicate to.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image131.png" title="Contosofinancialdb - Geo-Replication blade" alt="In the Contosofinancialdb - Geo-Replication blade, under Target Regions, South Central US is selected." /><figcaption>In the Contosofinancialdb - Geo-Replication blade, under Target Regions, South Central US is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Create secondary</strong> blade, click on <strong>Target server</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image132.png" title="Create Secondary blade" alt="In the Create Secondary blade, Target server is selected." /><figcaption>In the Create Secondary blade, Target server is selected.</figcaption>
</figure></li>
<li><p>On the <strong>New server</strong> blade, enter the following values:</p>
<ul>
<li><p>Server name: <strong>enter a unique name</strong></p></li>
<li><p>Server admin login: <strong>demouser</strong></p></li>
<li><p>Password: <strong>demo@pass123</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image133.png" title="New server blade" alt="Fields in the New server blade are set to the previously defined settings." /><figcaption>Fields in the New server blade are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>Select</strong>.</p></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Database replication is now configured.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image134.png" title="Contosofinancialdb - Geo-Replication blade" alt="The Contosofinancialdb - Geo-Replication blade displays, with the Primary Server set to North Central US, and the Secondaries set to South Central US." /><figcaption>The Contosofinancialdb - Geo-Replication blade displays, with the Primary Server set to North Central US, and the Secondaries set to South Central US.</figcaption>
</figure></li>
</ol>
<h2 id="exercise-7-take-down-old-architecture-resources">Exercise 7: Take down old architecture / resources</h2>
<p>Since the Contoso Financial application has now been migrated to Azure PaaS services utilizing Azure App Service, the older, existing architecture no longer being used needs to be removed. Since the application has been validated to work as expected, you have been asked to delete the Azure IaaS components hosting the VM infrastructure.</p>
<h4 id="step-1-remove-old-vm-based-tiers">Step 1: Remove Old VM-based tiers</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, and then click on the <strong>ContosoExistingRG</strong> resource group.</p></li>
<li><p>Delete the following resources that are hosting the OLD Web App, API, and Background tiers.</p>
<ul>
<li><p><strong>BackgroundAV</strong></p></li>
<li><p><strong>WebAPIAV</strong></p></li>
<li><p><strong>Background1</strong></p></li>
<li><p><strong>WebAPI1</strong></p></li>
<li><p><strong>WebAPI2</strong></p></li>
<li><p><strong>WebApp1</strong></p></li>
<li><p><strong>WebApp2</strong></p></li>
<li><p><strong>WebAPILB</strong></p></li>
<li><p><strong>WebAppLB</strong></p></li>
<li><p><strong>background1nic</strong></p></li>
<li><p><strong>webapi1nic</strong></p></li>
<li><p><strong>webapi2nic</strong></p></li>
<li><p><strong>webapp1nic</strong></p></li>
<li><p><strong>webapp2nic</strong></p></li>
<li><p><strong>Background1-ip</strong></p></li>
<li><p><strong>WebAPI1-ip</strong></p></li>
<li><p><strong>WebAPI2-ip</strong></p></li>
<li><p><strong>WebApp1-ip</strong></p></li>
<li><p><strong>WebApp2-ip</strong></p></li>
<li><p><strong>WebAPPLBIP</strong></p></li>
<li><p><strong>AppVNET</strong></p></li>
<li><p><strong>Background1-nsg</strong></p></li>
<li><p><strong>WebAPI1-nsg</strong></p></li>
<li><p><strong>WebApp1-nsg</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image135.png" title="Azure Portal" alt="In the Azure Portal left menu, Resource groups is selected. In the Resource grups blade, ContosoExistingRG is selected. In the ContosoExistingRG blade, Overview is selected, and all names under the list of resources are selected." /><figcaption>In the Azure Portal left menu, Resource groups is selected. In the Resource grups blade, ContosoExistingRG is selected. In the ContosoExistingRG blade, Overview is selected, and all names under the list of resources are selected.</figcaption>
</figure></li>
</ul>
<blockquote>
<p>Be sure not to delete the Azure SQL Database (<strong>contosofinancialdb</strong>) and Azure SQL Server. These are still in use!</p>
</blockquote></li>
<li><p>Delete the <strong>Storage Accounts</strong> with the following name prefixes:</p>
<ul>
<li><p><strong>diag</strong></p></li>
<li><p><strong>disk</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image136.png" title="Storage Accounts" alt="The two previously listed Storage Accounts display." /><figcaption>The two previously listed Storage Accounts display.</figcaption>
</figure></li>
</ul></li>
<li><p>Once all of the resources for the VMs that are no longer needed have been deleted / removed from the <strong>ContosoExistingRG</strong> resource group, the only resources left in that resource group should be the <strong>SQL Databases and Servers</strong>.<br />
<br />
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image137.png" title="ContosoExistingRG blade" alt="In the left pane of the ContosoExistingRG blade, Overview is selected. In the top menu, the Refresh button is selected." /></p></li>
</ol>
<h2 id="exercise-8-setup-european-web-app-tier-instance">Exercise 8: Setup European Web App Tier Instance</h2>
<p>As Contoso Financial expands into Europe, they need to handle the additional growth while maintaining the same application performance. While to fully support global scale, there are pieces of the application that will need to be refactored, as you have been asked to setup a secondary region for the Front-end Web App Tier in the Azure North Europe region.</p>
<h4 id="help-references-6">Help references</h4>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-web-overview/">Azure Web Apps overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-dotnet-get-started/">Deploy an ASP.NET web app to Azure App Service, using Visual Studio</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-configure/">Configure web apps in Azure App Service</a></p>
<h4 id="step-1-create-european-app-service">Step 1: Create European App Service</h4>
<ol type="1">
<li><p>From the Azure Management portal: <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>+New</strong>, then <strong>Web + Mobile</strong>, and then click on <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image75.png" title="Azure Portal" alt="New is selected in the Azure Portal left pane. In the New blade, under Azure Marketplace, Web + Mobile is selected, and under Featured, the Web App quickstart tutorial is selected." /><figcaption>New is selected in the Azure Portal left pane. In the New blade, under Azure Marketplace, Web + Mobile is selected, and under Featured, the Web App quickstart tutorial is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Web App</strong> blade, enter the following values:</p>
<ul>
<li><p>App name: <strong>enter a unique name</strong></p></li>
<li><p>Resource Group: <strong>OptimizedWebAppEuropeRG</strong></p></li>
<li><p>App Insights: <strong>Off<br />
<br />
</strong><img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image138.png" title="Web App blade" alt="Fields in the Web App blade are set to the previously defined settings." /><strong><br />
</strong></p></li>
</ul></li>
<li><p>Click on <strong>App Service plan/Location</strong>, then <strong>Create New</strong>, and fill in the following values:</p>
<ul>
<li><p>App Service Plan: <strong>OptimizedWebAppEuropePlan</strong></p></li>
<li><p>Location: <strong>North Europe</strong></p></li>
<li><p>Pricing tier: <strong>S1 Standard</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image139.png" title="App Service plan blade" alt="Fields in the App Service plan blade are set to the previously defined settings." /><figcaption>Fields in the App Service plan blade are set to the previously defined settings.</figcaption>
</figure></li>
</ul></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click <strong>Create</strong>.</p></li>
</ol>
<h4 id="step-2-set-app-settings">Step 2: Set App Settings</h4>
<ol type="1">
<li><p>Click on <strong>Resource groups</strong>, and select the <strong>OptimizedWebAppEuropeRG</strong> resource group. Then, click on the <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image140.png" title="Azure Portal" alt="In the Azure Portal left menu, Resource groups is selected. In the Resource groups pane, under Subscriptions, OptimizedWebAppEuropeRG is selected. In the OptimizedWebAppEuropeRG blade, both Overview and the contosofinancialwebappeuro App Service are selected" /><figcaption>In the Azure Portal left menu, Resource groups is selected. In the Resource groups pane, under Subscriptions, OptimizedWebAppEuropeRG is selected. In the OptimizedWebAppEuropeRG blade, both Overview and the contosofinancialwebappeuro App Service are selected</figcaption>
</figure></li>
<li><p>On the <strong>Web App</strong> blade, click on <strong>Application settings</strong>.<strong><br />
<br />
</strong><img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image141.png" title="Web App blade" alt="In the Web App blade, under Settings, Application settings is selected." /><strong><br />
</strong></p></li>
<li><p>Scroll down to the <strong>App settings</strong> section, and create a <strong>new</strong> app setting with the following values:</p>
<ul>
<li><p>Key: <strong>transactionAPIUrl</strong></p></li>
<li><p>Value: <strong>paste in the URL of the App Service Web App that is hosting the API tier. This should be set to the same value used for the Web App Tier in the North Central US region.</strong></p></li>
</ul>
<blockquote>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image142.png" title="contosofinancialwebappeuro blade" alt="In the contosofinancialwebappeuro blade, under Settings, Application settings is selected. Under App settings, fields are set to the previously defined settings." /><figcaption>In the contosofinancialwebappeuro blade, under Settings, Application settings is selected. Under App settings, fields are set to the previously defined settings.</figcaption>
</figure>
</blockquote></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>
<h4 id="step-3-deploy-web-app-to-european-region">Step 3: Deploy Web App to European Region</h4>
<ol type="1">
<li><p>From the <em>C:\HOL\Contoso.Financial</em> folder, open the Visual Studio Solution: <strong>Contoso.Financial.sln</strong>.</p></li>
<li><p>In the <strong>Solution Explorer</strong> window, expand the <strong>Web</strong> folder, then right-click the <strong>Contoso.Financial.Website</strong> project, and click on <strong>Publish…</strong></p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image143.png" title="Solution Explorer" alt="In Solution Explorer, the Web folder is expanded, and Contoso.Financial.Website is selected. From its right-click menu, Publish is selected." /><figcaption>In Solution Explorer, the Web folder is expanded, and Contoso.Financial.Website is selected. From its right-click menu, Publish is selected.</figcaption>
</figure></li>
<li><p>Click the <strong>Create new profile</strong> link.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image144.png" title="Publish window" alt="In the Publish window, the Create new profile link is selected." /><figcaption>In the Publish window, the Create new profile link is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Pick a publish target</strong> dialog, click on <strong>Microsoft Azure App Service</strong>, and choose <strong>Select Existing</strong>, Then, click <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image145.png" title="Pick a publish target window" alt="In the Pick a publish target window, Microsoft Azure App Service, Select Existing, and the OK button are all selected." /><figcaption>In the Pick a publish target window, Microsoft Azure App Service, Select Existing, and the OK button are all selected.</figcaption>
</figure></li>
<li><p>On the <strong>App Service</strong> dialog, expand the <strong>OptimizedWebAppEuropeRG</strong> resource group, select the <strong>Web App</strong> in the North Europe region, and then, click <strong>OK</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image146.png" title="App Service dialog box" alt="In the App Service dialog box, the OptimizedWebAppEuropeRG folder is expanded, and contosofinancialwebappeuro is selected." /><figcaption>In the App Service dialog box, the OptimizedWebAppEuropeRG folder is expanded, and contosofinancialwebappeuro is selected.</figcaption>
</figure></li>
<li><p>Select the Deployment Profile for the European instance, and click <strong>Publish</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image147.png" title="Publish window" alt="In the Publish window, contosofinancialwebappeuro - Web Deploy is set as the deployment profile, and the Publish button is selected." /><figcaption>In the Publish window, contosofinancialwebappeuro - Web Deploy is set as the deployment profile, and the Publish button is selected.</figcaption>
</figure></li>
<li><p>Once the deployment has completed, Visual Studio will automatically open a new browser window navigating to the <strong>Web App</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image148.png" title="Contoso Financial login page" alt="The Contoso Financial login page displays." /><figcaption>The Contoso Financial login page displays.</figcaption>
</figure></li>
</ol>
<h4 id="step-4-add-european-region-to-traffic-manager">Step 4: Add European Region to Traffic Manager</h4>
<ol type="1">
<li><p>From the Azure Management Portal <a href="http://portal.azure.com" class="uri">http://portal.azure.com</a>, using a new tab or instance, click on <strong>Resource groups</strong>, click on the <strong>OptimizedTFRG</strong> resource group, then click on the <strong>Traffic Manager</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image83.png" title="Azure Portal" alt="In the Azure Portal left menu, Resource groups is selected. In the Resource groups pane, under Subscriptions, OptimizedTFRG is selected. In the OptimizedTFRG blade, both Overview and the contosowebapp Traffic Manager are selected." /><figcaption>In the Azure Portal left menu, Resource groups is selected. In the Resource groups pane, under Subscriptions, OptimizedTFRG is selected. In the OptimizedTFRG blade, both Overview and the contosowebapp Traffic Manager are selected.</figcaption>
</figure></li>
<li><p>On the <strong>Traffic Manager profile</strong> blade, click on <strong>Endpoints</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image149.png" title="Endpoints option" alt="Screenshot of the Endpoints option." /><figcaption>Screenshot of the Endpoints option.</figcaption>
</figure></li>
<li><p>Click <strong>Add</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image150.png" title="contosowebapp - Endpoints blade" alt="On the contosowebapp - Endpoints blade menu, the Add button is selected." /><figcaption>On the contosowebapp - Endpoints blade menu, the Add button is selected.</figcaption>
</figure></li>
<li><p>On the <strong>Add endpoint</strong> blade, enter the following values:</p>
<ul>
<li><p>Type: <strong>Azure endpoint</strong></p></li>
<li><p>Name: <strong>Web App (Europe)</strong></p></li>
<li><p>Target resource type: <strong>App Service</strong></p></li>
</ul>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image151.png" title="Add endpoint blade" alt="Fields in the Add endpoint blade are set to the previously defined settings." /><figcaption>Fields in the Add endpoint blade are set to the previously defined settings.</figcaption>
</figure></li>
<li><p>Click on <strong>Choose an app service</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image87.png" title="Choose an app service option" alt="Screenshot of the Choose an app service option." /><figcaption>Screenshot of the Choose an app service option.</figcaption>
</figure></li>
<li><p>Click on the <strong>Web App</strong> created in the <strong>North Europe</strong> region.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image152.png" title="Resource blade" alt="On the Resource blade, contosofinancialwebappeuro is selected." /><figcaption>On the Resource blade, contosofinancialwebappeuro is selected.</figcaption>
</figure></li>
<li><p>Set the <strong>Regional grouping</strong> to <strong>Europe</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image153.png" title="Geo-mapping section" alt="Under Geo-mapping, Regional grouping is set to Europe." /><figcaption>Under Geo-mapping, Regional grouping is set to Europe.</figcaption>
</figure></li>
<li><p>Click <strong>OK</strong>.</p></li>
<li><p>Click on <strong>Overview</strong>.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image154.png" title="contosowebapp - Endpoints blade" alt="Overview is selected in the contosowebapp - Endpoints blade." /><figcaption>Overview is selected in the contosowebapp - Endpoints blade.</figcaption>
</figure></li>
<li><p>On the <strong>Traffic Manager profile</strong> blade, click on the <strong>DNS name</strong> to open a new browser window navigating to the <strong>Traffic Manager</strong> endpoint.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image155.png" title="Traffic Manager profile blade" alt="In the Traffic Manager profile blade, Overview, and the DNS name contosowebapp.trafficmanager.net link are selected." /><figcaption>In the Traffic Manager profile blade, Overview, and the DNS name contosowebapp.trafficmanager.net link are selected.</figcaption>
</figure></li>
<li><p>Login to the Web App and ensure it loads all data as expected to test out the App Service hosted Web App and API App tiers are functioning properly.</p>
<figure>
<img src="images/Hands-onlabstep-by-step-Optimizedarchitectureimages/media/image100.png" title="Contoso Financial Account Overview webpage" alt="The Contoso Financial Account Overview webpage displays with Transaction details in an account transaction ledger." /><figcaption>The Contoso Financial Account Overview webpage displays with Transaction details in an account transaction ledger.</figcaption>
</figure></li>
<li><p>After validating the app, close the browser window.</p></li>
</ol>
<h4 id="section"></h4>
<h2 id="after-the-hands-on-lab">After the hands-on lab</h2>
<h4 id="task-1-delete-resources">Task 1: Delete Resources</h4>
<ol type="1">
<li>Now that the HOL is complete, go ahead and delete all of the Resource Groups created for this HOL. You will no longer need those resources, and it will be beneficial to clean up your Azure Subscription.</li>
</ol>
<p>You should follow all steps provided <em>after</em> attending the HOL.</p>
</body>
</html>
