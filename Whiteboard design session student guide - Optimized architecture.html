<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>MCW: Optimized Architecture – includes</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://opsgilitylabs.blob.core.windows.net/lablayout/labstyles.css"></link>
</head>
<body>
<h1 id="optimized-architecture">Optimized architecture</h1>
<h2 id="whiteboard-design-session-student-guide">Whiteboard design session student guide</h2>
<h2 id="march-2018">March 2018</h2>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#optimized-architecture-whiteboard-design-session-student-guide">Optimized architecture whiteboard design session student guide</a>
<ul>
<li><a href="#abstract-and-learning-objectives">Abstract and learning objectives</a></li>
<li><a href="#step-1-review-the-customer-case-study">Step 1: Review the customer case study</a>
<ul>
<li><a href="#facilitatorsubject-matter-expert-sme-presentation-of-customer-case-study">Facilitator/subject matter expert (SME) presentation of customer case study</a></li>
<li><a href="#customer-situation">Customer situation</a></li>
<li><a href="#customer-needs">Customer needs</a></li>
<li><a href="#customer-objections">Customer objections</a></li>
<li><a href="#infographic-for-common-scenarios">Infographic for common scenarios</a></li>
</ul></li>
<li><a href="#step-2-design-a-proof-of-concept-solution">Step 2: Design a proof of concept solution</a></li>
<li><a href="#step-3-present-the-solution">Step 3: Present the solution</a></li>
<li><a href="#wrap-up">Wrap-up</a></li>
<li><a href="#additional-references">Additional references</a></li>
</ul></li>
</ul>
<h2 id="abstract-and-learning-objectives">Abstract and learning objectives</h2>
<p>In this workshop, you will learn how to optimize a lift and shift style IaaS architecture in Azure to improve cost savings. You will also compare IaaS and PaaS hosting options to save cost even further using Azure App Service. Additionally, students will learn to improve resiliency and high availability through multi-region deployment.</p>
<p>Attendees will learn how to:</p>
<ul>
<li><p>Optimize Azure IaaS for cost savings</p></li>
<li><p>Migrate an Azure IaaS optimized</p></li>
<li><p>Compare cost between Azure IaaS versus Azure PaaS</p></li>
<li><p>Setup SQL Database geo-replication</p></li>
<li><p>Configure multi-region deployment</p></li>
</ul>
<h2 id="step-1-review-the-customer-case-study">Step 1: Review the customer case study</h2>
<p><strong>Outcome</strong></p>
<p>Analyze your customer’s needs.</p>
<h4 id="facilitatorsubject-matter-expert-sme-presentation-of-customer-case-study">Facilitator/subject matter expert (SME) presentation of customer case study</h4>
<p>Time frame: 15 minutes</p>
<p>Directions: With all participants in the session, the facilitator/SME presents an overview of the customer case study along with technical tips.</p>
<ol type="1">
<li><p>Meet your table participants and trainer.</p></li>
<li><p>Read all the directions for Steps 1–3 in the Student guide.</p></li>
<li><p>As a table team, review the following customer case study.</p></li>
</ol>
<h4 id="customer-situation">Customer situation</h4>
<p>Contoso Financial Inc. is one of the fastest growing financial organizations in the United States. With its corporate headquarters in Chicago, IL, the company has grown to over 1,000 employees. Most employees work from one of the regional offices strategically located in all the major United States cities. However, many of the employees work remotely either daily or even after hours.</p>
<p>Contoso has recently completed a migration to shift most its enterprise data center footprint to the cloud. “The cloud is the future, and as such, it is essential for us to proactively adopt the cloud before our competitors to remain innovative and as competitive as possible,” says Emma Lowton, Chief Technology Officer. “Unfortunately, due to our limited expertise in cloud computing, I have grown concerned that our Azure spending is much higher than it should be.”</p>
<p>The migration process performed by Contoso used the “Lift and shift” method to move their existing workloads into Microsoft Azure. Their current Azure usage is dependent on the Infrastructure as a Service (IaaS) services in addition to the adoption of Azure Active Directory (AD) and Office 365. So far, they have not used the Platform as a Service (PaaS) services very much except for Azure Storage and Azure Service Bus Queue, which replaced MSMQ.</p>
<p>Last year, Contoso completed the acquisition of the European based Lucerne Ltd. With the acquisition complete, a deadline was set to begin migrating all Lucerne employees to the Contoso systems within 18 months. The Chief Executive Office, Jay Calvin’s biggest concern with the existing architecture is, “With concerns about spending too much, I am very concerned we will not be able to stay competitive, as we onboard the Lucerne employees over to use Contoso systems.”</p>
<p>The company has over 120 workloads migrated to running in Microsoft Azure. Only a small number of these are considered mission critical. Ultimately, all the workloads will need to be optimized for reduced Azure spending without compromising system resiliency and reliability. The Contoso’s IT Operations team has identified a single mission critical workload that consists of a 3-tier web application with a SQL Server database. After optimization has been proven with this single application, plans will be laid to perform similar cost optimizations across their entire cloud footprint.</p>
<p>It has already been identified that the existing Azure architecture has been overprovisioned for the workload. The existing architecture within Azure needs to be modified to match more closely with the workload demand and use some of the cloud features of Azure that allow for greater cost savings. In addition to reducing cost, the architecture also needs to be optimized to be able to handle Contoso’s future growth, even after Lucerne employees have been onboarded.</p>
<p><strong>Existing architecture</strong></p>
<p>Percy Bowman is the Director of IT Operations and manages the team responsible for maintaining the enterprise systems. Percy is concerned that “the current architecture is much too difficult to maintain over time with all of the manual operations necessary, especially as the company continues to grow and expand into Europe.” The existing architecture is made up of multiple virtual machines that need to be fully managed and maintained by Contoso today. As the company continues to grow, the system needs to be able to scale more easily, as adding more VMs over time will eventually lead to prohibitive costs. It is the primary reason the Contoso enterprise workloads were migrated into the cloud in the first place.</p>
<p>The system is broken out into three tiers (Front-end Web App, Back-end Web API, Back-end Processing) and a Microsoft SQL Server database server. The VM count for the different tiers remains the same as when the system was hosted on-premises since they performed a straight “Lift and shift” to move into Azure. The Web App and Web API tiers are made up of three VMs each. Both the Web App and Web API tiers use an Azure Load Balancer to distribute traffic across the redundant VMs. The Back-end Processing tier is made up of two VMs for redundancy, with the additional benefit of meeting the SLA uptime guarantee.</p>
<p>The Front-end Web App and Back-end Web API tiers are hosted on Windows Server 2012 R2 using Microsoft Internet Information Services (IIS). The server-side application code for the Front-end Web App tier is written in C# using ASP.NET MVC 5. The application code for the Back-end Web API tier is written in C# using ASP.NET Web API and uses Entity Framework to communicate with the SQL Server database.</p>
<p>The Back-end Processing tier is hosted on Windows Server 2012 R2 with the application code written as a C# Console Application. The Back-end Processing tier receives messages of work to be done from the Back-end Web API tier using an Azure Service Bus Queue.</p>
<p>The database server is somewhat of a problem area with the current architecture. During the migration, the productionpPilot environment was setup in the Azure West US region. When the final production environment was built out, it was determined the Azure North Central US region would be used to better serve users and be located geographically closer to the corporate headquarters. The database server is running Microsoft SQL Server 2014, and is hosted on a single VM. So far, the overall necessary performance demand has been met, but the database server lacks redundancy. The way it is hosted was only meant to be temporary when going live into full production. However, in the rush to put out other production fires at the time of “Go Live”, the Production Pilot VM for the database server stayed in place. According to Percy Bowman, Directory of IT Operations, “the database server has not failed us yet, but we know this setup is less than ideal. Although, we do keep backups in the event of a failure.”</p>
<figure>
<img src="images/Whiteboarddesignsessionstudentguide-Optimizedarchitectureimages/media/image2.png" title="Existing architecture diagram" alt="Diagram of the previously described Existing architecture." /><figcaption>Diagram of the previously described Existing architecture.</figcaption>
</figure>
<p><strong>Existing virtual machine utilization</strong></p>
<p>The Contoso IT Operations team decided to standardize on the “Standard D3” VM instance size (4 cores, 14GB RAM) for the Front-end and Back-end tiers using Standard storage. The SQL Server database server VM needs more resources so it is configured to use the “Standard GS4” VM instance size (16 cores, 224GB RAM).</p>
<p>Contoso IT Operations team does use some third-party tools to aggregate server metrics for simplified reporting and monitoring processes. However, the primary method they used to gather the CPU and RAM utilization of the specific workload to target was to sign in to the Azure Portal and access Azure’s VM monitoring within the Virtual Machine blade. They gathered both the “CPU percentage” and “Memory usage” statistics to get average CPU and RAM utilization percentages for the virtual machines.</p>
<p>The average CPU and RAM usage of the servers during normal business hours (8AM – 5PM, Monday through Friday) and the estimated cost per VM is as follows:</p>
<figure>
<img src="images/Whiteboarddesignsessionstudentguide-Optimizedarchitectureimages/media/image3.png" title="Standard D3 pricing tier" alt="In this Standard D3 pricing tier, the first row is Front-End Web App Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38 percent or RAM of 44 percent. The second row is the Back-End Web App Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56 percent or RAM of 31 percent. The third row is Back-end processing tier, which is CPU of 49 percent, and RAM of 25 percent. The bottom row, Database Server SQL Database: Preium P4, has no CPU or RAM information." /><figcaption>In this Standard D3 pricing tier, the first row is Front-End Web App Tier, which offers CPU of 36 percent and RAM of 46 percent, or CPU of 38 percent or RAM of 44 percent. The second row is the Back-End Web App Tier, which has CPU of 58 percent and RAM of 34 percent, or CPU of 56 percent or RAM of 31 percent. The third row is Back-end processing tier, which is CPU of 49 percent, and RAM of 25 percent. The bottom row, Database Server SQL Database: Preium P4, has no CPU or RAM information.</figcaption>
</figure>
<p><strong>Database usage analysis</strong></p>
<p>One of the Database Administrators at Contoso, Naina Dhyani, has completed some additional performance profiling to help determine how to optimize the SQL Server VM. Using the production server, Naina captured performance metrics and used the Azure SQL Database DTU Calculator to determine the estimated DTU (data through-put unit) requirements of the SQL Server VM. According to Naina, “It gave me the result that our database requires about 400 DTUs. I am really not sure what a DTU is, but I know Azure SQL Databases use that for billing.”</p>
<h4 id="customer-needs">Customer needs</h4>
<ol type="1">
<li><p>Design a two-phase approach to the process of migrating Azure resources towards the goal of optimized spending.</p></li>
<li><p>Fix the SQL Server database hosting to be more robust, reliable, and enterprise-grade.</p></li>
<li><p>Automatic scaling needs to be implemented to reduce the manual process involved.</p></li>
<li><p>Identify the appropriate method to use for scaling out the different application tiers to meet increases in load.</p></li>
<li><p>Identify the appropriate VM sizes for each application tier.</p></li>
<li><p>Validate the appropriate Azure Regions are used for hosting and create a plan to migrate any necessary resources to a different region.</p></li>
<li><p>Identify the PaaS services to use, and the App Service Plans, and create a migration plan.</p></li>
<li><p>Identify a strategy to reduce server maintenance as the system is scaled out to meet increased load.</p></li>
<li><p>The migration steps should not require any changes to application code.</p></li>
</ol>
<h4 id="customer-objections">Customer objections</h4>
<ol type="1">
<li><p>Reducing the overall spending on Azure is great, but how will we ensure costs remain optimized?</p></li>
<li><p>If we drastically change the overall architecture, will we be able to migrate it without taking it down for a week?</p></li>
<li><p>Our operations team is new to the cloud and Microsoft Azure. While we are comfortable using the IaaS services, we are concerned that PaaS services will be difficult to monitor and maintain when mixed with IaaS services in our overall environment.</p></li>
<li><p>We are concerned that the system performance for the European users will not be as good as it needs to be. In the past, we have had employees work while traveling and the system was slow for them.</p></li>
<li><p>The VM sizes currently used appear to be more than we need, but how can we determine what the appropriate sizes should be?</p></li>
<li><p>We have already purchased SQL Server and other product licenses. I am worried the savings from optimizing spending using Azure PaaS services will not be significant to be worth it.</p></li>
</ol>
<h4 id="infographic-for-common-scenarios">Infographic for common scenarios</h4>
<h6 id="azure-virtual-network-with-vms-and-load-balancers">Azure virtual network with VMs and load balancers</h6>
<figure>
<img src="images/Whiteboarddesignsessionstudentguide-Optimizedarchitectureimages/media/image4.png" title="Azure infrastructure" alt="Azure infrastructure showing front end subnet and back end subnet." /><figcaption>Azure infrastructure showing front end subnet and back end subnet.</figcaption>
</figure>
<h6 id="tier-azure-web-app-architecture-with-message-queue">3-tier Azure Web App architecture with message queue</h6>
<figure>
<img src="images/Whiteboarddesignsessionstudentguide-Optimizedarchitectureimages/media/image5.png" title="3-tier Azure Web App architecture with message queue" alt="The 3-tier Azure Web App architecture with message queue is split into two sections: Internet (with three user icons), and Azure, with everything else. The users on the internet side go through a Traffic Manager to the Azure App Service, with Web App Instances and Autoscale. This points to the Azure App Service / Back-end Tier, with Web API Instances and Autoscale. This points to Azure SQL Databases, and also shares a bi-directional arrow with Message Queue (Storage Queue or Service Bus Queue.) The Message Queue points to Web Job Instances with AutoScale, which completes the circle by pointing back to Web API Instances." /><figcaption>The 3-tier Azure Web App architecture with message queue is split into two sections: Internet (with three user icons), and Azure, with everything else. The users on the internet side go through a Traffic Manager to the Azure App Service, with Web App Instances and Autoscale. This points to the Azure App Service / Back-end Tier, with Web API Instances and Autoscale. This points to Azure SQL Databases, and also shares a bi-directional arrow with Message Queue (Storage Queue or Service Bus Queue.) The Message Queue points to Web Job Instances with AutoScale, which completes the circle by pointing back to Web API Instances.</figcaption>
</figure>
<h2 id="step-2-design-a-proof-of-concept-solution">Step 2: Design a proof of concept solution</h2>
<p><strong>Outcome</strong></p>
<p>Design a solution and prepare to present the solution to the target customer audience in a 15-minute chalk-talk format.</p>
<p>Time frame: 60 minutes</p>
<p><strong>Business needs</strong></p>
<p>Directions: With all participants at your table, answer the following questions, and list the answers on a flip chart.</p>
<ol type="1">
<li><p>Who should you present this solution to? Who is your target customer audience? Who are the decision makers?</p></li>
<li><p>What customer business needs do you need to address with your solution?</p></li>
</ol>
<p><strong>Design</strong></p>
<p>Directions: With all participants at your table, respond to the following questions on a flip chart.</p>
<p><strong>Two-phase solution</strong></p>
<p><strong>Phase 1</strong></p>
<p>Design the changes to the existing solution architecture using IaaS (Infrastructure as a Service) services to reduce and optimize the cost of Azure. Included in this phase should be a solution to make the SQL Server more robust. Identify the steps necessary to modify the architecture and what needs to be demonstrated to stakeholders.</p>
<ul>
<li><p>Database server</p>
<ul>
<li><p>Which Azure SQL Database hosting solution would you recommend?</p></li>
<li><p>What is the recommended Azure Region to use for the SQL Database?</p></li>
<li><p>What is the recommended Azure SQL Database pricing tier?</p></li>
</ul></li>
<li><p>Cost optimization</p>
<ul>
<li><p>What VM scaling solution is recommended?</p></li>
<li><p>How do you determine the appropriate VM size for each tier?</p></li>
<li><p>What are the recommended VM size and count to use for each application tier?</p></li>
<li><p>What is the calculated cost and overall savings gained from this design?</p></li>
<li><p>How do these optimizations reduce the total cost of server maintenance and operation?</p></li>
</ul></li>
<li><p>Migration</p>
<ul>
<li>What order or steps would you recommend taking when changing the architecture?</li>
</ul></li>
<li><p>Diagram the solution</p></li>
</ul>
<p><strong>Phase 2</strong></p>
<p>Outline the changes necessary to transform the Phase 1 architecture design over to further optimizing Azure spend by using the Azure PaaS (Platform as a Service) services that fit the solution. Identify the steps necessary and what needs to be demonstrated to stakeholders to convince them of the viability of the final solution architecture design.</p>
<ul>
<li><p>Cost optimization</p>
<ul>
<li><p>What services would you recommend to further optimize the solution for lower total cost?</p></li>
<li><p>How do you determine the appropriate App Service Plan to use?</p></li>
<li><p>What are the recommended App Service Plans to use for each application tier?</p></li>
<li><p>What is the calculated cost and overall savings gained from this design?</p></li>
<li><p>How do these optimizations reduce the total cost of server maintenance and operation?</p></li>
</ul></li>
<li><p>Scalability</p>
<ul>
<li>What service should be used to ensure expected application performance is maintained when on-boarding Lucerne employees?</li>
</ul></li>
<li><p>Migration</p>
<ul>
<li>What order or steps would you recommend taking when changing the architecture?</li>
</ul></li>
<li><p>Diagram the solution</p></li>
</ul>
<p><strong>Prepare</strong></p>
<p>Directions: With all participants at your table:</p>
<ol type="1">
<li><p>Identify any customer needs that are not addressed with the proposed &gt; solution.</p></li>
<li><p>Identify the benefits of your solution.</p></li>
<li><p>Determine how you will respond to the customer’s objections.</p></li>
</ol>
<p>Prepare a 15-minute chalk-talk style presentation to the customer.</p>
<h2 id="step-3-present-the-solution">Step 3: Present the solution</h2>
<p><strong>Outcome</strong></p>
<p>Present a solution to the target customer audience in a 15-minute chalk-talk format.</p>
<p><strong>Presentation</strong></p>
<p>Timeframe: 30 minutes</p>
<p><strong>Directions</strong></p>
<ol type="1">
<li><p>Pair with another table.</p></li>
<li><p>One table is the Microsoft team and the other table is the customer.</p></li>
<li><p>The Microsoft team presents their proposed solution to the customer.</p></li>
<li><p>The customer makes one of the objections from the list of objections.</p></li>
<li><p>The Microsoft team responds to the objection.</p></li>
<li><p>The customer team gives feedback to the Microsoft team.</p></li>
<li><p>Tables switch roles and repeat Steps 2–6.</p></li>
</ol>
<h2 id="wrap-up">Wrap-up</h2>
<p>Time frame: 15 minutes</p>
<ul>
<li>Tables reconvene with the larger group to hear a SME share the &gt; preferred solution for the case study.</li>
</ul>
<h2 id="additional-references">Additional references</h2>
<p><a href="https://azure.microsoft.com/en-us/documentation/services/virtual-machines/windows/">Windows Virtual Machines documentation</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/reserved-vm-instances/">Azure Reserved VM instances</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machines/#Windows">Virtual Machine pricing</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machine-scale-sets/">Virtual Machine Scale Sets pricing</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-networks-overview/">Virtual Network overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-networks-nsg/">Network security group (NSG) overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/load-balancer-overview/">Load Balancer overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/traffic-manager-overview/">Traffic Manager overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-web-overview/">Web apps overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-webjobs-readme/">Web jobs overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-scale/">Scale a Web App</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/sql-database-technical-overview/">Introduction to Azure SQL database</a></p>
<p><a href="https://azure.microsoft.com/en-us/documentation/articles/sql-database-benchmark-overview/">Azure SQL Database benchmark overview</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/details/sql-database/">Azure SQL Database pricing</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/calculator/channel/">Azure Channel Pricing calculator</a></p>
<p><a href="https://azure.microsoft.com/en-us/pricing/calculator">Azure Pricing Calculator</a></p>
<p><a href="http://dtucalculator.azurewebsites.net/">Azure SQL database DTU calculator</a></p>
</body>
</html>
